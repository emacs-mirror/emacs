<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">



 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>

  <head>

   <title>References in the MPS</title>

  </head>

  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>

   <div align='center'>

    <h1>References in the MPS</h1>

    <p>incomplete</p>

    <address>drj, 1998-08-27</address>

   </div>

   <p>

    <strong>THIS DOCUMENT IS NOT TO BE RELEASED TO CLIENTS.</strong>

   </p>

   <p>It is obsolete.  Useful content will be merged with other documentation.  pekka 2000-05-19</p>

   <h2>

    <a id='section-introduction' name='section-introduction'>Introduction</a>

   </h2>

   <p>

    <strong>.intro</strong>

    : References are crucial to (automatic) memory management.  They are the means by which objects refer to each other.

   </p>

   <h2>

    <a id='section-creation' name='section-creation'>Creation</a>

   </h2>

   <p>

    <strong>.create</strong>

    : References are in two ways; by creating objects or roots containing references, or by allocating an object (which creates a reference to the object allocated).

   </p>

   <h2>

    <a id='section-destruction' name='section-destruction'>Destruction</a>

   </h2>

   <p>

    <strong>.destroy</strong>

    : References are not destroyed explicitly; they are destroyed whenever objects or roots containing references are destroyed or whever references contained in objects or roots are overwritten by the mutator or the memory manager (which can only happen in certain restricted circumstances.

   </p>

   <h2>

    <a id='section-types' name='section-types'>Types</a>

   </h2>

   <p>

    [See also 

    guide.mps.pool-classes

    :prop.ref.* and 

    guide.mps.pool-classes

    :prop.rank.* which has a more structured explanation of the differences between the types of reference  drj 1998-09-02]

   </p>

   <p>

    <strong>.type</strong>

    : There are three types of reference:

   </p>

   <p>

    <strong>.type.exact</strong>

    : Exact references.  These are the usual sort of reference.  The value is definitely a reference to an object (compare with Ambiguous Reference below) and the client wishes that the reference continue to the refer to the object as long as the objects remains alive (compare with Weak Reference below).  The MPS is allowed to change the address represented by the reference in order that the object being referred to can be moved.

   </p>

   <p>

    <strong>.type.ambig</strong>

    : Ambiguous references.  Bit of a misnomer because it may not actually be a reference.  This is a value which may or may not be a reference to an object and the memory manager has no way to determine which is the case.  This presents some interesting implications for the memory manager: chiefly that if the representation of an ambiguous reference looks like a genuine reference to an object then it must be treated as a reference to the object (so will cause the object to be preserved if the ambigous reference is itself reachable), but the ambiguous reference cannot be changed (because to do so if the value was not a reference would be catastrophic), so the object referred to cannot be moved.

   </p>

   <p>

    <strong>.type.weak</strong>

    : Weak references.  A weak reference is a reference to an object which does not cause the object to be preserved.  As long as the object remains alive the weak reference will refer to it.  But when the object is no longer reachable from the root via a chain of exact or ambiguous references then the memory manager may replace all weak references to the object with some value which is not a reference to the object.  Just as for exact references, the MPS is allowed to change the address represented by the reference.

   </p>

   <p>Denotation</p>

   <p>

    <strong>.type.denote</strong>

    : Typically in the MPS where an explicit distinction between the types of reference is required, the types of reference are denoted using Ranks.  There is a rank for each of the types of reference described above.  In the MPS C Interface they are mps_rank_ambig() (see 

    symbol.mps.c.mps_rank_ambig

    ) for Ambiguous References, mps_rank_exact() (see 

    symbol.mps.c.mps_rank_exact

    ) for Exact References, mps_rank_weak() (see 

    symbol.mps.c.mps_rank_weak

    ) for Weak References.

   </p>

   <h2>

    <a id='section-representation' name='section-representation'>Representation</a>

   </h2>

   <p>

    <strong>.represent.overview</strong>

    : The client can store references in whatever format they like as long as:

   </p>

   <p>- All the bits which participate in the representation of a reference in an object X reside entirely within the boundaries of the object X [this somewhat reasonable - though violated by ScriptWorks - condition is necessary to make barriers work simply drj 1998-08-28].</p>

   <p>- References are converted to and from void * C pointers whenever communicating them through the MPS C interface.</p>

   <h2>

    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>

   </h2>

   <p>Scanning</p>

   <p>Fixing</p>

   <p>Object Allocation</p>

   <p>Tricky issues here.  When is an exact reference valid?  When do they come into existence?  What if mps_commit fails, what happens to the "reference" that the mutator thought they had?</p>

   <h2>

    <a id='section-A' name='section-A'>A. References</a>

   </h2>

   <h2>

    <a id='section-B' name='section-B'>B. Document History</a>

   </h2>

   <table>

    <tr valign='top'>

     <td>1998-08-27 14:23:33 +00</td>

     <td />

     <td>New document saved</td>

    </tr>

    <tr valign='top'>

     <td>1998-08-27 15:08:41 +00</td>

     <td />

     <td>stuff</td>

    </tr>

    <tr valign='top'>

     <td>1998-08-27 15:08:48 +00</td>

     <td>drj</td>

     <td>.type.*</td>

    </tr>

    <tr valign='top'>

     <td>1998-08-28 14:40:10 +00</td>

     <td />

     <td>added .represent</td>

    </tr>

    <tr valign='top'>

     <td>1998-08-28 14:40:18 +00</td>

     <td>drj</td>

     <td>added .represent</td>

    </tr>

    <tr valign='top'>

     <td>1998-09-02 13:07:55 +00</td>

     <td>drj</td>

     <td>denotation</td>

    </tr>

    <tr valign='top'>

     <td>1998-09-02 13:40:49 +00</td>

     <td>drj</td>

     <td>linked to symbol doc</td>

    </tr>

    <tr valign='top'>

     <td>2000-05-19 16:19:59 +01</td>

     <td>pekka</td>

     <td>add warning</td>

    </tr>

    <tr valign='top'>

     <td>2001-09-26</td>

     <td>

      <a href='mailto:ndl@ravenbrook.com'>NDL</a>

     </td>

     <td>Converted from xml to html (second pass).</td>

    </tr>

   </table>

   <hr />

   <p>

    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>

   </p>

   <div align='center'>

    <p>

     <code>$Id$</code>

    </p>

   </div>

  </body>

 </html>

