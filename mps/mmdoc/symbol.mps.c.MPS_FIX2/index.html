<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">

 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
  <head>
   <title>MPS C Interface: macro MPS_FIX2</title>
  </head>
  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>
   <div align='center'>
    <h1>MPS C Interface: macro MPS_FIX2</h1>
    <p>draft</p>
    <address>pekka, 1998-01-19</address>
   </div>
   <h2>
    <a id='section-name' name='section-name'>Name</a>
   </h2>
   <p>MPS_FIX2</p>
   <h2>
    <a id='section-summary' name='section-summary'>Summary</a>
   </h2>
   <p>The macro MPS_FIX2, together with MPS_FIX1, is the part of the scanning protocol used to indicate references to the MPS.  It may only be used from within MPS_SCAN_BEGIN and MPS_SCAN_END.</p>
   <h2>
    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>
   </h2>
   <p>Scanning.</p>
   <h2>
    <a id='section-syntax' name='section-syntax'>Syntax</a>
   </h2>
   <p>
    MPS_FIX2(mps_ss, ref_io);
    <br />
   </p>
   <h2>
    <a id='section-arguments' name='section-arguments'>Arguments</a>
   </h2>
   <p>mps_ss    the scan state argument that was passed to the scanning function</p>
   <p>ref_io    a pointer to a reference within the object being scanned, type mps_addr_t *</p>
   <h2>
    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>
   </h2>
   <p>Returns a result code, see ERROR HANDLING.</p>
   <p>
    If the reference rank of the object being scanned is not 
    <code>MPS_RANK_AMBIG</code>
     then the reference pointed to by 
    <code>ref_io</code>
     may be modified by 
    <code>MPS_FIX2</code>
    .
   </p>
   <h2>
    <a id='section-resources' name='section-resources'>Resources</a>
   </h2>
   <p>mps.h.</p>
   <h2>
    <a id='section-description' name='section-description'>Description</a>
   </h2>
   <p>MPS_FIX1 and MPS_FIX2 are a trick to speed up scanning by splitting MPS_FIX12 into two macros.  MPS_FIX1 is a fast test to see if the reference is likely to be interesting to the MPS; if it returns false, the scanner can proceed to the next reference.  If it returns true, the scan method must invoke MPS_FIX2, which does the actual fixing.</p>
   <p>
    This macro may only be used in code textually between MPS_SCAN_BEGIN and MPS_SCAN_END.
    <br />
   </p>
   <p>
    This macro does not perform any particular operation.  The MPS may call scanning functions for a number of reasons, and 
    <code>MPS_FIX2</code>
     may take different actions depending on those reasons.
   </p>
   <h2>
    <a id='section-example' name='section-example'>Example</a>
   </h2>
   <p>
    mps_res_t scan_array(mps_ss_t ss, Array object, size_t length)
{
    <br />
      size_t i;
   </p>
   <p>  mps_res_t res;</p>
   <p>  mps_addr_t *array = (mps_addr_t *)object;</p>
   <p>  MPS_SCAN_BEGIN(ss)</p>
   <p>    for(i = 0; i &lt; length; ++i) {</p>
   <p>      mps_addr_t ref = array[i];</p>
   <p>      if(MPS_FIX1(ss, ref)) {</p>
   <p>        /* if(((Object*)ref)-&gt;type == ScannableType) { */</p>
   <p>        /* You can do something here, but in the end, you must call MPS_FIX2. */</p>
   <p>          res = MPS_FIX2(ss, &amp;array[i]);</p>
   <p>          if(res != MPS_RES_OK) return res;</p>
   <p>        /* } */</p>
   <p>      }</p>
   <p>    }</p>
   <p>  MPS_SCAN_END(ss);</p>
   <p>
      return res;
    <br />
    }
   </p>
   <h2>
    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>
   </h2>
   <p>
    The macro returns 
    <code>MPS_RES_OK</code>
     if it was successful, in which case the scanning function should continue to scan the rest of the object, fixing the remaining references.  If 
    <code>MPS_FIX2</code>
     returns a value other than 
    <code>MPS_RES_OK</code>
    , the scanning function must return that value, and may return without scanning further references.  Generally, it is better if it returns as soon as possible.
    <br />
   </p>
   <h2>
    <a id='section-see-also' name='section-see-also'>See Also</a>
   </h2>
   <p>MPS_FIX12, MPS_FIX1, mps_fix, mps_ss_t, mps_root_scan_t, mps_fmt_scan_t, mps_reg_scan_t, MPS_SCAN_BEGIN, MPS_SCAN_END, MPS_FIX_CALL</p>
   <h2>
    <a id='section-A' name='section-A'>A. References</a>
   </h2>
   <h2>
    <a id='section-B' name='section-B'>B. Document History</a>
   </h2>
   <table>
    <tr valign='top'>
     <td>1998-01-19 14:10:29 +00</td>
     <td>pekka</td>
     <td>New document saved</td>
    </tr>
    <tr valign='top'>
     <td>1998-02-04 18:10:46 +00</td>
     <td>pekka</td>
     <td>Note the current restrictions</td>
    </tr>
    <tr valign='top'>
     <td>2000-06-06 15:31:35 +01</td>
     <td>pekka</td>
     <td>clean up; MPS_FIX12</td>
    </tr>
    <tr valign='top'>
     <td>2001-09-26</td>
     <td>
      <a href='mailto:ndl@ravenbrook.com'>NDL</a>
     </td>
     <td>Converted from xml to html (second pass).</td>
    </tr>
   </table>
   <hr />
   <p>
    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>
   </p>
   <div align='center'>
    <p>
     <code>$Id$</code>
    </p>
   </div>
  </body>
 </html>
