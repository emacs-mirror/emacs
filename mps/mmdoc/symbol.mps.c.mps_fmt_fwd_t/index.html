<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">

 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
  <head>
   <title>MPS C Interface: type mps_fmt_fwd_t</title>
  </head>
  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>
   <div align='center'>
    <h1>MPS C Interface: type mps_fmt_fwd_t</h1>
    <p>draft</p>
    <address>drj, 1999-05-10</address>
   </div>
   <h2>
    <a id='section-name' name='section-name'>Name</a>
   </h2>
   <p>mps_fmt_fwd_t</p>
   <h2>
    <a id='section-summary' name='section-summary'>Summary</a>
   </h2>
   <p>
    The type of a format's forward method.
    <br />
   </p>
   <h2>
    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>
   </h2>
   <p>Format.</p>
   <h2>
    <a id='section-type' name='section-type'>Type</a>
   </h2>
   <p>
    <pre>typedef void (*mps_fmt_fwd_t)(mps_addr_t old, mps_addr_t new);</pre>
    <br />
   </p>
   <h2>
    <a id='section-arguments' name='section-arguments'>Arguments</a>
   </h2>
   <p>old</p>
   <p>  the address of an object</p>
   <p>new</p>
   <p>
      the address where the object has been moved
    <br />
   </p>
   <h2>
    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>
   </h2>
   <p>None.</p>
   <h2>
    <a id='section-description' name='section-description'>Description</a>
   </h2>
   <p>
    <code>mps_fmt_fwd_t</code>
     is t
    he type of a format's forward method.  A forward method is used to store relocation information in a heap.
      It may be called by the MPS as part of copying garbage collection.
   </p>
   <p>
    <br />
    A forward method is provided by the client as part of a format (see Format Protocol
    ).  The MPS calls a forward method when it has relocated an object.  The forward method when called must replace the object at 'old' with a forwarding marker that points to the address 'new'.  The forwarding marker must meet the following requirements:
   </p>
   <p>- it must be possible for the MPS to call other format methods with the address of a forwarding marker as the argument.</p>
   <p>- the forwarding marker must not be bigger than the original object.</p>
   <p>
    - it must be possible to distinguish the forwarding marker from ordinary objects using the isfwd method (see 
    <code>mps_fmt_isfwd_t</code>
    ), and the isfwd method must return the address 'new'.
   </p>
   <h2>
    <a id='section-example' name='section-example'>Example</a>
   </h2>
   <p>/* define the function */</p>
   <p>void example_fwd(mps_addr_t old, mps_addr_t new)</p>
   <p>{</p>
   <p>  /* ... */</p>
   <p>}</p>
   <p>/* also define example_scan, example_skip, etc */</p>
   <p>/* store pointer to function in the format variant struct */</p>
   <p>struct mps_fmt_B_s example_fmt_B = {</p>
   <p>  4,		/* align */</p>
   <p>  example_scan,</p>
   <p>  example_skip,</p>
   <p>  example_copy,</p>
   <p>  example_fwd,</p>
   <p>  example_isfwd,</p>
   <p>  example_pad,</p>
   <p>  example_class</p>
   <p>};</p>
   <p>/* The (address of the) example_fmt_B object can now be passed to */</p>
   <p>/* mps_fmt_create_B to create a format. */</p>
   <h2>
    <a id='section-see-also' name='section-see-also'>See Also</a>
   </h2>
   <p>
    mps_fmt_A_s, 
    mps_fmt_B_s
    ,
    mps_fmt_auto_header_s, 
    mps_fmt_isfwd_t
   </p>
   <h2>
    <a id='section-notes' name='section-notes'>Notes</a>
   </h2>
   <p>This method is never invoked by the GC on an object in a non-moving pool.</p>
   <h2>
    <a id='section-A' name='section-A'>A. References</a>
   </h2>
   <h2>
    <a id='section-B' name='section-B'>B. Document History</a>
   </h2>
   <table>
    <tr valign='top'>
     <td>1999-05-10 16:36:13 +00</td>
     <td>drj</td>
     <td>New document saved</td>
    </tr>
    <tr valign='top'>
     <td>1999-05-12 16:12:57 +00</td>
     <td>drj</td>
     <td>examples plus see alsos</td>
    </tr>
    <tr valign='top'>
     <td>2000-05-22 16:32:53 +01</td>
     <td>pekka</td>
     <td>clean up</td>
    </tr>
    <tr valign='top'>
     <td>2000-05-23 15:59:01 +01</td>
     <td>pekka</td>
     <td>more cleanups</td>
    </tr>
    <tr valign='top'>
     <td>2000-09-20 17:54:11 +01</td>
     <td>pekka</td>
     <td>note non-moving</td>
    </tr>
    <tr valign='top'>
     <td>2001-09-26</td>
     <td>
      <a href='mailto:ndl@ravenbrook.com'>NDL</a>
     </td>
     <td>Converted from xml to html (second pass).</td>
    </tr>
   </table>
   <hr />
   <p>
    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>
   </p>
   <div align='center'>
    <p>
     <code>$Id$</code>
    </p>
   </div>
  </body>
 </html>
