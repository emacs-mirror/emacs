<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">



 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>

  <head>

   <title>MPS C Interface: function mps_stack_scan_ambig</title>

  </head>

  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>

   <div align='center'>

    <h1>MPS C Interface: function mps_stack_scan_ambig</h1>

    <p>draft</p>

    <address>pekka, 1998-01-23</address>

   </div>

   <h2>

    <a id='section-name' name='section-name'>Name</a>

   </h2>

   <p>mps_stack_scan_ambig</p>

   <h2>

    <a id='section-summary' name='section-summary'>Summary</a>

   </h2>

   <p>A scanning function for ambiguous scanning of thread states.</p>

   <h2>

    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>

   </h2>

   <p>Root.</p>

   <h2>

    <a id='section-syntax' name='section-syntax'>Syntax</a>

   </h2>

   <p>

    mps_res_t mps_stack_scan_ambig(mps_ss_t scan_state, mps_thr_t thread,

    <br />

                                   void *stack_bottom, size_t ignore)

    <br />

   </p>

   <h2>

    <a id='section-arguments' name='section-arguments'>Arguments</a>

   </h2>

   <p>scan_state    a scan state</p>

   <p>thread        the thread</p>

   <p>stack_bottom  a pointer to the bottom of the stack</p>

   <p>ignore        ignored</p>

   <h2>

    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>

   </h2>

   <p>A result code.</p>

   <h2>

    <a id='section-resources' name='section-resources'>Resources</a>

   </h2>

   <p>mps.h</p>

   <h2>

    <a id='section-description' name='section-description'>Description</a>

   </h2>

   <p>

    This is 

    a root scanning function of type 

    <code>mps_reg_scan_t</code>

    . 

     It will scan all integer registers and everything on the stack of the thread given, and can therefore only be used with roots of rank 

    <code>MPS_RANK_AMBIG</code>

    .  

    It will only scan things at the given stack bottom pointer or higher on the stack (that is, more recently added).  References are assumed to be represented as machine words, and are required to be 

    4-byte-aligned

    ; unaligned values are ignored.

   </p>

   <p>

    Clients don't call this function, it is used as an argument of 

    <code>mps_root_create_reg</code>

    .

   </p>

   <h2>

    <a id='section-example' name='section-example'>Example</a>

   </h2>

   <p>typedef struct {</p>

   <p>  mps_root_t mmRoot;</p>

   <p>  mps_thr_t thread;</p>

   <p>  ...</p>

   <p>} ThreadLocals;</p>

   <p>

    <br />

    void InitThread(ThreadLocals *thr)

   </p>

   <p>{</p>

   <p>  /* This is a hack to find the bottom of the stack. */</p>

   <p>  void *stackBottom=&amp;stackBottom;</p>

   <p>  mps_thread_reg(&amp;thr-&gt;thread, arena);</p>

   <p>  mps_root_create_reg(&amp;thr-&gt;mmRoot, arena, MPS_RANK_AMBIG, (mps_rm_t)0,</p>

   <p>                      thr-&gt;thread, mps_stack_scan_ambig, stackBottom, 0)</p>

   <p>  ...</p>

   <p>}</p>

   <h2>

    <a id='section-see-also' name='section-see-also'>See Also</a>

   </h2>

   <p>

    mps_reg_scan_t, 

    mps_root_create_reg

   </p>

   <h2>

    <a id='section-notes' name='section-notes'>Notes</a>

   </h2>

   <p>The MPS provides this function because it's hard to write (it's OS- and architecture-dependent and possibly compiler-dependent).</p>

   <h2>

    <a id='section-A' name='section-A'>A. References</a>

   </h2>

   <h2>

    <a id='section-B' name='section-B'>B. Document History</a>

   </h2>

   <table>

    <tr valign='top'>

     <td>1998-01-23 19:47:08 +00</td>

     <td>pekka</td>

     <td>New document saved</td>

    </tr>

    <tr valign='top'>

     <td>2000-05-22 17:23:11 +01</td>

     <td>pekka</td>

     <td>clean</td>

    </tr>

    <tr valign='top'>

     <td>2000-11-29 19:45:31 +00</td>

     <td>pekka</td>

     <td>describe representation</td>

    </tr>

    <tr valign='top'>

     <td>2001-09-26</td>

     <td>

      <a href='mailto:ndl@ravenbrook.com'>NDL</a>

     </td>

     <td>Converted from xml to html (second pass).</td>

    </tr>

   </table>

   <hr />

   <p>

    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>

   </p>

   <div align='center'>

    <p>

     <code>$Id$</code>

    </p>

   </div>

  </body>

 </html>

