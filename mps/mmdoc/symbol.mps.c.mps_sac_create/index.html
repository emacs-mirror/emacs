<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">

 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
  <head>
   <title>MPS C Interface: function mps_sac_create</title>
  </head>
  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>
   <div align='center'>
    <h1>MPS C Interface: function mps_sac_create</h1>
    <p>draft</p>
    <address>pekka, 1999-03-04</address>
   </div>
   <h2>
    <a id='section-name' name='section-name'>Name</a>
   </h2>
   <p>mps_sac_create</p>
   <h2>
    <a id='section-summary' name='section-summary'>Summary</a>
   </h2>
   <p>
    This function creates a 
    segregated allocation cache.
   </p>
   <h2>
    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>
   </h2>
   <p>Allocation cache</p>
   <h2>
    <a id='section-type' name='section-type'>Type</a>
   </h2>
   <p>
    <pre>mps_res_t mps_sac_create(mps_sac_t *sac_o, mps_pool_t pool, size_t classes_count, mps_sac_classes_s *classes);</pre>
   </p>
   <h2>
    <a id='section-arguments' name='section-arguments'>Arguments</a>
   </h2>
   <p>sac_o          a pointer to a variable to hold the cache created</p>
   <p>pool           the pool the cache is attached to</p>
   <p>classes_count  the number of the size classes</p>
   <p>
    classes
            pointer to the first element of an array describing the size classes
   </p>
   <h2>
    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>
   </h2>
   <p>
    If the return value is 
    <code>MPS_RES_OK</code>
    , a new cache in 
    <code>*sac_o</code>
    .
    <br />
   </p>
   <h2>
    <a id='section-resources' name='section-resources'>Resources</a>
   </h2>
   <p>mps.h</p>
   <h2>
    <a id='section-description' name='section-description'>Description</a>
   </h2>
   <p>
    This function creates an allocation cache whose free-list is segregated into the given 
    size classes.  The cache can get more memory from the given pool, or return memory to it.
   </p>
   <p>Segregated allocation caches can be associated with any pool that supports mps_alloc and mps_free.</p>
   <p>
    The size classes are described by an array of element type 
    <code>mps_sac_classes_s</code>
     (q.v.).  This array is used to initialize the cache, and is not needed after 
    <code>mps_sac_create</code>
     returns.  There might be a limit on how many classes can be described, but it will be no less than 
    <code>MPS_SAC_CLASS_LIMIT</code>
    .  You must specify at least one class.  The MPS automatically provides an "overlarge" class for arbitrarily large objects above the largest class described.  Allocations falling into the overlarge class are not cached.
   </p>
   <h2>
    <a id='section-example' name='section-example'>Example</a>
   </h2>
   <p>
    <pre>  mps_sac_t sac;
  mps_sac_classes_s classes[3] = { {8, 38, 1}, {136, 19, 3}, {512, 4, 1} };
  res = mps_sac_create(&amp;sac, pool, 3, classes);
  if (res != MPS_RES_OK) {
    printf("Failed to create the allocation cache!"); exit(1);
  }</pre>
   </p>
   <h2>
    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>
   </h2>
   <p>
    <code>mps_sac_create</code>
     returns 
    <code>MPS_RES_MEMORY</code>
     or
    <code>MPS_RES_COMMIT_LIMIT</code>
    when it fails to allocate memory for the internal cache structure; see the documentation for those return codes for recovery options.  It returns 
    <code>MPS_RES_LIMIT</code>
     if you ask for too many size classes; combine some small adjacent classes.  It returns 
    <code>MPS_RES_PARAM</code>
     if the pool doesn't support segregated allocation caches.
   </p>
   <h2>
    <a id='section-see-also' name='section-see-also'>See Also</a>
   </h2>
   <p>
    mps_sac_classes_s
    , 
    MPS_SAC_CLASS_LIMIT
    , mps_sac_destroy
    , 
    MPS_RES_MEMORY
    , 
    MPS_RES_COMMIT_LIMIT
    , 
    MPS_RES_LIMIT
    , 
    MPS_RES_PARAM
    ,
     mps_sac_t
    <br />
   </p>
   <h2>
    <a id='section-notes' name='section-notes'>Notes</a>
   </h2>
   <p>
    Too many classes will slow down allocation; too few classes waste more space in internal fragmentation.
      It is assumed that overlarge allocations are rare; otherwise, you would add another class for them, or even create separate allocation caches or pools for them.
   </p>
   <p>Some pools will work more efficiently with caches than others.  In the future, the MPS might offer pools specially optimized for particular types of cache.</p>
   <p>Segregated allocation caches work poorly with debug pool classes at the moment: the checking only happens when blocks are moved between the cache and the pool.  This will be fixed, but the speed of allocation with a debug class will always be similar to mps_alloc, rather than cached speed.</p>
   <h2>
    <a id='section-A' name='section-A'>A. References</a>
   </h2>
   <h2>
    <a id='section-B' name='section-B'>B. Document History</a>
   </h2>
   <table>
    <tr valign='top'>
     <td>1999-03-04 13:46:44 +00</td>
     <td />
     <td>New document saved</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-04 14:06:22 +00</td>
     <td>pekka</td>
     <td>add size class; fix problems</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-05 16:07:16 +00</td>
     <td>pekka</td>
     <td>Use array for size classes</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-17 14:01:25 +00</td>
     <td>pekka</td>
     <td>describe handling of class array</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-18 16:47:57 +00</td>
     <td>pekka</td>
     <td>new arg definition</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-18 20:45:00 +00</td>
     <td>pekka</td>
     <td>correct debug class support</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-22 19:43:11 +00</td>
     <td>pekka</td>
     <td>mention COMMIT_LIMIT</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-23 14:35:40 +00</td>
     <td>pekka</td>
     <td>new limit handling</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-25 15:08:20 +00</td>
     <td>pekka</td>
     <td>clarify</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-30 12:33:21 +01</td>
     <td>pekka</td>
     <td>improve phrasing</td>
    </tr>
    <tr valign='top'>
     <td>2000-06-23 20:45:22 +01</td>
     <td>pekka</td>
     <td>clean up</td>
    </tr>
    <tr valign='top'>
     <td>2001-09-26</td>
     <td>
      <a href='mailto:ndl@ravenbrook.com'>NDL</a>
     </td>
     <td>Converted from xml to html (second pass).</td>
    </tr>
   </table>
   <hr />
   <p>
    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>
   </p>
   <div align='center'>
    <p>
     <code>$Id$</code>
    </p>
   </div>
  </body>
 </html>
