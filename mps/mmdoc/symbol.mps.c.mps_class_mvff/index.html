<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">



 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>

  <head>

   <title>MPS C Interface: function mps_class_mvff</title>

  </head>

  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>

   <div align='center'>

    <h1>MPS C Interface: function mps_class_mvff</h1>

    <p>incomplete</p>

    <address> <a href='mailto:grm@ravenbrook.com'>GRM</a>

, 1998-09-09</address>

   </div>

   <h2>

    <a id='section-name' name='section-name'>Name</a>

   </h2>

   <p>mps_class_mvff</p>

   <p>

    <br />

   </p>

   <h2>

    <a id='section-summary' name='section-summary'>Summary</a>

   </h2>

   <p>

    Used as a parameter to mps_pool_create to create an MVFF pool.

    <br />

   </p>

   <h2>

    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>

   </h2>

   <p>Pool, Allocation Points.</p>

   <h2>

    <a id='section-type' name='section-type'>Type</a>

   </h2>

   <p>

    mps_class_t mps_class_mvff(void)

    <br />

   </p>

   <h2>

    <a id='section-arguments' name='section-arguments'>Arguments</a>

   </h2>

   <p>None.</p>

   <h2>

    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>

   </h2>

   <p>

    The function returns a class object that can be passed to mps_pool_create.

    <br />

   </p>

   <h2>

    <a id='section-resources' name='section-resources'>Resources</a>

   </h2>

   <p>mpscmvff.h</p>

   <h2>

    <a id='section-description' name='section-description'>Description</a>

   </h2>

   <p>MVFF pools implement a first-fit policy, and can be configured to be functionally equivalent to an EPDL or EPDR pool, but with better overall performance.  The pool requires six parameters to pool creation:</p>

   <p>  - mps_size_t extendBy -- The size of segment to allocate by default;</p>

   <p>  - mps_size_t avgSize -- The average size of objects to be allocated;</p>

   <p>  - mps_align_t alignment -- The alignment of addresses for allocation (and freeing) in the pool;</p>

   <p>  - mps_bool_t slotHigh</p>

   <p>  - mps_bool_t arenaHigh</p>

   <p>  - mps_bool_t firstFit</p>

   <p>

    The alignment is the alignment of ranges that can be allocated and freed.  If an unaligned size is passed to mps_alloc or mps_free, it will be rounded up to the pool's alignment.  The minimum alignment supported by pools of this class is "

    <pre>sizeof(void *)</pre>

    ".

   </p>

   <p>

    The three boolean parameters should be set to (0, 0, 1) to emulate EPDL, and (1, 1, 1) to emulate EPDR.  No other settings of these parameters is currently recommended.

    <br />

   </p>

   <p>Buffered allocation (mps_reserve and mps_commit) is also supported, but in that case, the policy is rather different: buffers are filled worst-fit, and allocation is always upwards from the base.  The arenaHigh parameter regulates whether new segments are acquired at high or low addresses; the slotHigh and firstFit parameters do not affect buffered allocation.  Buffered and unbuffered allocation can be used at the same time, but in that case, the first allocation point must be created before any call to mps_alloc.</p>

   <p>

    Cached allocation (

    MPS_SAC_ALLOC

     and 

    MPS_SAC_FREE

    )

     is also supported, but in that case, the policy is a little different: allocation from the cache follows its own policy (typically first-fit), and only when the cache needs to acquire more blocks from the underlying MVFF pool does it use the usual algorithm to choose blocks for the cache.

   </p>

   <h2>

    <a id='section-example' name='section-example'>Example</a>

   </h2>

   <p>if (mps_pool_create(&amp;pool, arena, mps_class_mvff(), 8 * 1024, 135, 4, 0, 0, 1)</p>

   <p>    != MPS_RES_OK) {</p>

   <p>  printf("Error creating pool!"); exit(2);</p>

   <p>

    }

    <br />

   </p>

   <h2>

    <a id='section-see-also' name='section-see-also'>See Also</a>

   </h2>

   <p>

    mps_pool_create, mps_class_epdr, mps_class_epdl, 

    mps_reserve, mps_commit, 

   </p>

   <h2>

    <a id='section-notes' name='section-notes'>Notes</a>

   </h2>

   <p>

    It is usually not advisable to 

    use buffered and unbuffered allocationat the same time, because the worst-fit policy of buffer filling will grab all the large blocks, leading to severe fragmentation.  Use two separate pools instead.

   </p>

   <p>Note that using buffered allocation prevents (for obscure technical reasons) the pool from allocating across segment boundaries.  This can cause added external fragmentation if objects are allocated that are a significant fraction of the segment size.  (This quirk will disappear in a future version.)</p>

   <h2>

    <a id='section-A' name='section-A'>A. References</a>

   </h2>

   <h2>

    <a id='section-B' name='section-B'>B. Document History</a>

   </h2>

   <table>

    <tr valign='top'>

     <td>1998-09-09 15:25:33 +01</td>

     <td>

      <a href='mailto:grm@ravenbrook.com'>GRM</a>

     </td>

     <td>New document saved</td>

    </tr>

    <tr valign='top'>

     <td>1998-10-09 16:41:33 +01</td>

     <td>

      <a href='mailto:grm@ravenbrook.com'>GRM</a>

     </td>

     <td>Add internal notes</td>

    </tr>

    <tr valign='top'>

     <td>1998-11-03 16:12:13 +00</td>

     <td>

      <a href='mailto:grm@ravenbrook.com'>GRM</a>

     </td>

     <td>Document alignment</td>

    </tr>

    <tr valign='top'>

     <td>1999-01-06 20:48:04 +00</td>

     <td>pekka</td>

     <td>buffered allocation; fix protocols, recources, etc.</td>

    </tr>

    <tr valign='top'>

     <td>1999-01-19 12:39:07 +00</td>

     <td>pekka</td>

     <td>add caveat</td>

    </tr>

    <tr valign='top'>

     <td>1999-01-19 16:03:19 +00</td>

     <td>pekka</td>

     <td>add another caveat and an example</td>

    </tr>

    <tr valign='top'>

     <td>1999-03-22 18:49:22 +00</td>

     <td>pekka</td>

     <td>Note caches</td>

    </tr>

    <tr valign='top'>

     <td>2001-09-26</td>

     <td>

      <a href='mailto:ndl@ravenbrook.com'>NDL</a>

     </td>

     <td>Converted from xml to html (second pass).</td>

    </tr>

   </table>

   <hr />

   <p>

    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>

   </p>

   <div align='center'>

    <p>

     <code>$Id$</code>

    </p>

   </div>

  </body>

 </html>

