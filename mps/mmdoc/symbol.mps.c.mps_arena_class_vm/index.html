<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">

 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
  <head>
   <title>MPS C Interface: function mps_arena_class_vm</title>
  </head>
  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>
   <div align='center'>
    <h1>MPS C Interface: function mps_arena_class_vm</h1>
    <p>draft</p>
    <address>pekka, 1997-09-26</address>
   </div>
   <h2>
    <a id='section-name' name='section-name'>Name</a>
   </h2>
   <p>mps_arena_class_vm</p>
   <h2>
    <a id='section-summary' name='section-summary'>Summary</a>
   </h2>
   <p>
    <code>mps_arena_class_vm</code>
     returns the virtual memory arena class.
   </p>
   <h2>
    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>
   </h2>
   <p>Arena.</p>
   <h2>
    <a id='section-syntax' name='section-syntax'>Syntax</a>
   </h2>
   <p>
    <pre>mps_arena_class_t mps_arena_class_vm(void)</pre>
    <br />
   </p>
   <h2>
    <a id='section-arguments' name='section-arguments'>Arguments</a>
   </h2>
   <p>None.</p>
   <h2>
    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>
   </h2>
   <p>
    Returns the virtual memory arena class.
    <br />
   </p>
   <h2>
    <a id='section-resources' name='section-resources'>Resources</a>
   </h2>
   <p>mpsavm.h</p>
   <h2>
    <a id='section-description' name='section-description'>Description</a>
   </h2>
   <p>
    This function is used to get hold of the virtual memory arena class, for the purpose of passing it to 
    <code>mps_arena_create</code>
    .
      The VM arenas use the OS virtual memory interfaces to allocate memory.  The chief consequence of this is that the arena can manage many more virtual addresses than it needs to commit memory to.
      This gives it flexibility as to where to place objects, which reduces fragmentation and helps make garbage collection more efficient.
   </p>
   <p>
    This class is similar to 
    <pre>mps_arena_class_vmnz</pre>
     but uses a more complex placement policy, which is more suited to copying garbage collection.
    <br />
   </p>
   <h2>
    <a id='section-example' name='section-example'>Example</a>
   </h2>
   <p>
    <pre>mps_arena_t arena;
int main(void)
{
  if(mps_arena_create(&amp;arena, mps_arena_class_vm(), ARENA_SIZE)
     != MPS_RES_OK) {
    printf("Not enough memory!");
    exit(1);
  }
  /* rest of program */
}</pre>
   </p>
   <h2>
    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>
   </h2>
   <p>None.</p>
   <h2>
    <a id='section-see-also' name='section-see-also'>See Also</a>
   </h2>
   <p>
    mps_arena_create
    , 
    mps_arena_class_vmnz
    <br />
   </p>
   <h2>
    <a id='section-notes' name='section-notes'>Notes</a>
   </h2>
   <p>
    A virtual memory arena gets its managed memory from the operating system's virtual memory services.  An initial address space size is passed when the arena is created.  When creating a virtual memory arena, 
    <code>mps_arena_create</code>
     takes one extra argument:
   </p>
   <p>
    <br />
    <pre>mps_res_t mps_arena_create(mps_arena_t *arena_o,
                           mps_arena_class_t arena_class_vm,
                           size_t size)</pre>
    <br />
   </p>
   <p>
    <code>size</code>
     is the initial amount of virtual address space, in bytes, that the arena will reserve (this space is initially reserved so that the arena can subsequently use it without interference from other parts of the program, but most of it is not committed, so it don't require any RAM or backing store).  The arena may allocate more virtual address space beyond this initial reservation as and when it deems it necessary.  The MPS is most efficient if you reserve an address space that is several times larger than your peak memory usage.
   </p>
   <p>
    <code>mps_arena_create</code>
     returns 
    <code>MPS_RES_RESOURCE</code>
     if it fails to reserve adequate address space to place the arena in; possibly other parts of the program are reserving too much virtual memory.  It returns 
    <code>MPS_RES_MEMORY</code>
     when it fails to allocate memory for the internal arena structures; either 
    <code>size</code>
     was far too small or you ran out of swap space.  It returns 
    <code>MPS_RES_FAIL</code>
    , if the library is copy-protected by a security device, such as a dongle, and a valid security device cannot be found.
   </p>
   <p>Virtual memory arenas are not available on the Mac platforms, other than MacOS X.  You will get a linking error, if you attempt to use this function.</p>
   <h2>
    <a id='section-A' name='section-A'>A. References</a>
   </h2>
   <h2>
    <a id='section-B' name='section-B'>B. Document History</a>
   </h2>
   <table>
    <tr valign='top'>
     <td>1997-09-26 20:13:46 +01</td>
     <td>pekka</td>
     <td>New document saved</td>
    </tr>
    <tr valign='top'>
     <td>1997-10-21 11:43:03 +01</td>
     <td>pekka</td>
     <td>clean up</td>
    </tr>
    <tr valign='top'>
     <td>1997-10-21 11:54:22 +01</td>
     <td>pekka</td>
     <td>make it draft</td>
    </tr>
    <tr valign='top'>
     <td>1997-10-24 15:39:00 -04</td>
     <td>lmb</td>
     <td>Put conventions in line with rest of symbol doc</td>
    </tr>
    <tr valign='top'>
     <td>1998-02-10 18:18:45 +00</td>
     <td>
      <a href='mailto:grm@ravenbrook.com'>GRM</a>
     </td>
     <td>Fix typo</td>
    </tr>
    <tr valign='top'>
     <td>1998-09-09 16:24:01 +00</td>
     <td>drj</td>
     <td>semantics of size parm have changed; so has the doc now</td>
    </tr>
    <tr valign='top'>
     <td>1999-01-05 16:15:47 +00</td>
     <td>pekka</td>
     <td>note Mac status</td>
    </tr>
    <tr valign='top'>
     <td>2000-07-17 12:21:15 +01</td>
     <td>pekka</td>
     <td>dongle; clean up; more about VMNZ</td>
    </tr>
    <tr valign='top'>
     <td>2000-07-19 13:41:55 +01</td>
     <td>pekka</td>
     <td>note that the space should be large</td>
    </tr>
    <tr valign='top'>
     <td>2000-07-20 19:01:08 +01</td>
     <td>pekka</td>
     <td>Note it's bytes</td>
    </tr>
    <tr valign='top'>
     <td>2001-09-26</td>
     <td>
      <a href='mailto:ndl@ravenbrook.com'>NDL</a>
     </td>
     <td>Converted from xml to html (second pass).</td>
    </tr>
   </table>
   <hr />
   <p>
    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>
   </p>
   <div align='center'>
    <p>
     <code>$Id$</code>
    </p>
   </div>
  </body>
 </html>
