<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">

 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
  <head>
   <title>MPS C Interface: function mps_root_create</title>
  </head>
  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>
   <div align='center'>
    <h1>MPS C Interface: function mps_root_create</h1>
    <p>draft</p>
    <address>pekka, 1997-09-22</address>
   </div>
   <h2>
    <a id='section-name' name='section-name'>Name</a>
   </h2>
   <p>
    mps_root_create
    <br />
   </p>
   <h2>
    <a id='section-summary' name='section-summary'>Summary</a>
   </h2>
   <p>
    The function "mps_root_create" declares a root 
    that consists of all the references indicated by a scanning function.
    <br />
   </p>
   <h2>
    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>
   </h2>
   <p>Root.</p>
   <h2>
    <a id='section-syntax' name='section-syntax'>Syntax</a>
   </h2>
   <p>mps_res_t mps_root_create(mps_root_t *root_o, mps_arena_t arena, mps_rank_t rank, mps_rm_t rm, mps_root_scan_t scan, void *p, size_t s)</p>
   <h2>
    <a id='section-arguments' name='section-arguments'>Arguments</a>
   </h2>
   <p>root_o      a pointer to a variable to store the new root structure</p>
   <p>arena       the arena</p>
   <p>rank        the rank of references in the root</p>
   <p>rm          the root mode</p>
   <p>scan        the scanning function</p>
   <p>p           a value to be passed to the scanning function</p>
   <p>
    s           
    a value to be passed to the scanning function
   </p>
   <h2>
    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>
   </h2>
   <p>
    If the return value is "MPS_RES_OK", 
    a new root structure in "*root_o".
   </p>
   <h2>
    <a id='section-resources' name='section-resources'>Resources</a>
   </h2>
   <p>mps.h.</p>
   <h2>
    <a id='section-description' name='section-description'>Description</a>
   </h2>
   <p>
    The client provides a scanning function, that will be called with a scan state and "p" and "s", whenever the root needs to be scanned.  See "
    mps_root_scan_t" for details.
    <br />
   </p>
   <p>
    If the rank of the root is not "MPS_RANK_AMBIG", the contents of the root have to be valid whenever a GC happens, i.e., they have to be references to actual objects or "NULL".  If you're using asynchronous GC, this could be right after the root is registered, so the root has to be valid when it is registered.  It's OK for a root to have entries which point to memory not managed by the MPS -- they will simply be ignored.
    <br />
   </p>
   <h2>
    <a id='section-example' name='section-example'>Example</a>
   </h2>
   <p>
    static 
    mps_root_t
     mmRoot
    ;
   </p>
   <p>int main(void)</p>
   <p>{</p>
   <p>  mps_res_t res;</p>
   <p>  /* ... */</p>
   <p>
      res = mps_root_create(&amp;mmRoot, arena, MPS_RANK_EXACT, (mps_rm_t)0,
    <br />
                            &amp;rootScanner, NULL, 0);
   </p>
   <p>
      /* see 
    doc of mps_root_scan_t for definition of rootScanner */
   </p>
   <p>  if(res != MPS_RES_OK) exit(1);</p>
   <p>  /* ... */</p>
   <p>}</p>
   <h2>
    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>
   </h2>
   <p>"mps_root_create" returns "MPS_RES_MEMORY" when it fails to allocate memory for the internal root structure; you need to deallocate or reclaim something to make enough space, or expand the arena.</p>
   <h2>
    <a id='section-see-also' name='section-see-also'>See Also</a>
   </h2>
   <p>
    mps_root_scan_t, mps_rm_t, mps_rank_t, 
    mps_root_t, 
    mps_root_create_fmt,
     mps_root_create_table
    , MPS_RM_CONST
   </p>
   <h2>
    <a id='section-notes' name='section-notes'>Notes</a>
   </h2>
   <p>"p" and "s" are just arbitrary data that scanning function can use.  This is needed because C lacks local functions.</p>
   <h2>
    <a id='section-A' name='section-A'>A. References</a>
   </h2>
   <h2>
    <a id='section-B' name='section-B'>B. Document History</a>
   </h2>
   <table>
    <tr valign='top'>
     <td>1997-09-22 15:15:24 +01</td>
     <td>pekka</td>
     <td>New document saved</td>
    </tr>
    <tr valign='top'>
     <td>1997-10-28 15:17:47 -05</td>
     <td>lmb</td>
     <td>Deleted Type and Structure; added some quotes</td>
    </tr>
    <tr valign='top'>
     <td>1998-01-21 17:50:32 +00</td>
     <td>pekka</td>
     <td>completed</td>
    </tr>
    <tr valign='top'>
     <td>1998-01-22 12:02:50 +00</td>
     <td>pekka</td>
     <td>finish the example</td>
    </tr>
    <tr valign='top'>
     <td>1998-01-23 18:08:30 +00</td>
     <td />
     <td>fix typos</td>
    </tr>
    <tr valign='top'>
     <td>1998-01-23 18:08:39 +00</td>
     <td>pekka</td>
     <td>fix typoes</td>
    </tr>
    <tr valign='top'>
     <td>1998-01-26 18:11:17 +00</td>
     <td>pekka</td>
     <td>fix typos; add MPS_RM_CONST ref; add validity stuff</td>
    </tr>
    <tr valign='top'>
     <td>2000-05-22 18:15:51 +01</td>
     <td>pekka</td>
     <td>clean up</td>
    </tr>
    <tr valign='top'>
     <td>2001-09-26</td>
     <td>
      <a href='mailto:ndl@ravenbrook.com'>NDL</a>
     </td>
     <td>Converted from xml to html (second pass).</td>
    </tr>
   </table>
   <hr />
   <p>
    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>
   </p>
   <div align='center'>
    <p>
     <code>$Id$</code>
    </p>
   </div>
  </body>
 </html>
