<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">

 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
  <head>
   <title>MPS C Interface: function mps_sac_alloc</title>
  </head>
  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>
   <div align='center'>
    <h1>MPS C Interface: function mps_sac_alloc</h1>
    <p>draft</p>
    <address>pekka, 1999-03-04</address>
   </div>
   <h2>
    <a id='section-name' name='section-name'>Name</a>
   </h2>
   <p>mps_sac_alloc</p>
   <h2>
    <a id='section-summary' name='section-summary'>Summary</a>
   </h2>
   <p>This function allocates a block using the segregated allocation cache given.</p>
   <h2>
    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>
   </h2>
   <p>Allocation cache</p>
   <h2>
    <a id='section-type' name='section-type'>Type</a>
   </h2>
   <p>
    <pre>mps_res_t mps_sac_alloc(mps_addr_t *p_o, mps_sac_t sac, size_t size, mps_bool_t has_reservoir_permit);</pre>
    <br />
   </p>
   <h2>
    <a id='section-arguments' name='section-arguments'>Arguments</a>
   </h2>
   <p>p_o                      a pointer to a variable to hold the address of the new block</p>
   <p>
    sac                      the segregated 
    allocation cache
   </p>
   <p>size                     the size of the block requested</p>
   <p>
    <code>has_reservoir_permit</code>
      regulates access to the reservoir
   </p>
   <h2>
    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>
   </h2>
   <p>
    If the return value is 
    <code>MPS_RES_OK</code>
    , the address of a new block in 
    <code>*p_o</code>
    .
   </p>
   <h2>
    <a id='section-resources' name='section-resources'>Resources</a>
   </h2>
   <p>
    mps.h
    <br />
   </p>
   <h2>
    <a id='section-description' name='section-description'>Description</a>
   </h2>
   <p>
    This function allocates a block using the cache given.
      If no suitable block exists in the cache, it will ask for more memory from the associated pool.  
    <code>size</code>
     does not have to be one of the class sizes of the cache; it does not have to be aligned.
   </p>
   <p>The client is responsible for synchronising the access to the cache, but if the cache decides to access the pool, the MPS will properly synchronize with any other threads that might be accessing the same pool.</p>
   <p>
    <code>has_reservoir_permit</code>
     regulates whether the pool has permission to get more memory from the reservoir to satisfy this request.
    <br />
   </p>
   <h2>
    <a id='section-example' name='section-example'>Example</a>
   </h2>
   <p>
    <pre>  void *p;
  Foo *foo;
  res = mps_sac_alloc(&amp;p, sac, FooSIZE, is_in_panic);
  if (res != MPS_RES_OK) {
    printf("Failed to alloc foo!\n"); exit(1);
  }
  foo = p;
  /* use foo */
  mps_sac_free(sac, p, FooSIZE);</pre>
   </p>
   <h2>
    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>
   </h2>
   <p>
    <code>mps_sac_alloc</code>
     returns 
    <code>MPS_RES_MEMORY</code>
     when it fails to find enough memory; see the documentation for this return code for recovery options.  It returns 
    <code>MPS_RES_COMMIT_LIMIT</code>
     if it can't allocate without exceeding the arena commit limit; Free something to make more space or increase the limit using 
    <code>mps_arena_commit_limit_set</code>
    .  It returns 
    <code>MPS_RES_RESOURCE</code>
     if it has run out of swap space; Free something or terminate other processes on the same machine.
   </p>
   <h2>
    <a id='section-see-also' name='section-see-also'>See Also</a>
   </h2>
   <p>
    MPS_SAC_ALLOC_FAST
    , 
    mps_sac_free
    , 
    MPS_SAC_FREE
    _FAST
    , 
    mps_sac_t
    , 
    mps_reservoir_limit_set, 
    mps_arena_commit_limit_set
    , 
    MPS_RES_MEMORY
    ,
    MPS_RES_COMMIT_LIMIT, 
    MPS_RES_RESOURCE
   </p>
   <h2>
    <a id='section-notes' name='section-notes'>Notes</a>
   </h2>
   <p>
    There's also a macro called 
    <pre>MPS_SAC_ALLOC_FAST</pre>
    , that does the same thing.
      The macro is faster, but generates more code and does less checking.
   </p>
   <p>
    The block allocated can be larger than requested.  Blocks not matching any class size are allocated from the next largest class, and 
    blocks larger than the largest class size are simply allocated at the requested size (rounded up to alignment, as usual).
   </p>
   <p>
    Objects allocated through a 
    segregated allocation cache should only be freed through a 
    segregated allocation cache with the same class structure.  Using 
    <code>mps_free</code>
     on them can cause memory leaks, because the size of the block might be larger than you think.  Naturally, the cache must also be
    attached to the same pool.
   </p>
   <h2>
    <a id='section-A' name='section-A'>A. References</a>
   </h2>
   <h2>
    <a id='section-B' name='section-B'>B. Document History</a>
   </h2>
   <table>
    <tr valign='top'>
     <td>1999-03-04 13:22:06 +00</td>
     <td>pekka</td>
     <td>New document saved</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-04 13:36:32 +00</td>
     <td>pekka</td>
     <td>fixes</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-11 20:49:39 +00</td>
     <td>pekka</td>
     <td>add alignment info</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-18 20:40:09 +00</td>
     <td>pekka</td>
     <td>more details about the restrictions</td>
    </tr>
    <tr valign='top'>
     <td>1999-03-22 18:25:03 +00</td>
     <td>pekka</td>
     <td>add example</td>
    </tr>
    <tr valign='top'>
     <td>2000-08-16 13:36:02 +01</td>
     <td>pekka</td>
     <td>fix refs to _FAST</td>
    </tr>
    <tr valign='top'>
     <td>2001-09-26</td>
     <td>
      <a href='mailto:ndl@ravenbrook.com'>NDL</a>
     </td>
     <td>Converted from xml to html (second pass).</td>
    </tr>
   </table>
   <hr />
   <p>
    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>
   </p>
   <div align='center'>
    <p>
     <code>$Id$</code>
    </p>
   </div>
  </body>
 </html>
