<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>

<title>MPS C Interface: type mps_fmt_auto_header_s</title>

</head>

<body bgcolor="#FFFFFF" text="#000000" link="#000099" vlink="#660066" alink="#FF0000">

<div align="center">

<h1>MPS C Interface: type mps_fmt_auto_header_s</h1>

<p>draft</p>

<address>
<a href="mailto:nb@ravenbrook.com">Nick Barnes</a>,
<a href="http://www.ravenbrook.com/">Ravenbrook Limited</a>,
2002-04-15
</address>

</div>

<h2><a id="section-name" name="section-name">Name</a></h2>

<p>mps_fmt_auto_header_s</p>

<h2><a id="section-summary" name="section-summary">Summary</a></h2>

<p><code class="source">mps_fmt_auto_header_s</code> is a structure
used to create object formats of variant auto_header.</p>

<h2><a id="section-associated-protocols" name="section-associated-protocols">Associated Protocols</a></h2>

<p>Format.</p>

<h2><a id="section-type" name="section-type">Type</a></h2>

<blockquote><pre>
typedef struct mps_fmt_auto_header_s {
  mps_align_t     align;
  mps_fmt_scan_t  scan;
  mps_fmt_skip_t  skip;
  mps_fmt_fwd_t   fwd;
  mps_fmt_isfwd_t isfwd;
  mps_fmt_pad_t   pad;
  size_t          mps_headerSize;
} mps_fmt_auto_header_s;
</pre></blockquote>


<h2><a id="section-resources" name="section-resources">Resources</a></h2>

<p><code class="filename">mps.h</code></p>

<h2><a id="section-description" name="section-description">Description</a></h2>

<p>Objects of this type are intended to be used in the creation of
object formats.  Object formats describe the layout of client objects.

<code class="source">mps_fmt_auto_header_s</code> is a structure that
represents the particular collection of methods and values that
describes an object format of variant auto_header.</p>

<p>Broadly speaking, the object formats of this variant are suitable
for use in automatic memory management for objects with headers (hence
the name).  More precisely, this variant is intended for formats where
the client's pointers point some distance into the memory block
containing the object.  This typically happens when the objects have a
common header used for memory management or class system purposes, but
this situation also arises when the low bits of a pointer are used for
a tag.  The MPS does not care what the reason is, only about the
offset of the pointer in relation to the memory block.</p>

<p><code class="source">mps_fmt_auto_header_s</code>has the following
methods: <code class="source">scan</code>, <code
class="source">skip</code>, <code class="source">fwd</code>, <code
class="source">isfwd</code>, <code class="source">pad</code>, and the
following values:<code class="source">align</code> and <code
class="source">mps_headerSize</code>.</p>

<p><code class="source">align</code> is an integer value defines the
alignment of objects allocated with this format.  It should be large
enough to satisfy the alignment requirements of any field in the
objects, and it cannot be larger than the arena alignment.</p>

<p><code class="source">mps_headerSize</code> is the size of the
header, i.e., the offset of a client pointer from the base the memory
block.  For details of the methods, consult the reference pages for
the type of each method.</p>

<h2><a id="section-example" name="section-example">Example</a></h2>


<blockquote><pre>
mps_fmt_t create_format(mps_arena_t arena)
{
  mps_fmt format;
  mps_res_t res;
  mps_fmt_auto_header_s format_desc = { my_alignment, &amp;my_scan, &amp;my_skip, &amp;my_fwd,
                                        &amp;my_isfwd, &amp;my_pad, HEADER_SIZE };

  res = mps_fmt_create_auto_header(&amp;format, arena, &amp;format_desc);
  assert(res != MPS_RES_OK);

  return format;
}
</pre></blockquote>

<h2><a id="section-see-also" name="section-see-also">See Also</a></h2>

<p>mps_fmt_create_auto_header, mps_fmt_scan_t, mps_fmt_skip_t, mps_fmt_fwd_t, mps_isfwd_t, mps_pad_t, mps_align_t, mps_fmt_A_s</p>

<h2><a id="section-notes" name="section-notes">Notes</a></h2>

<p>For technical reasons, client objects must be longer than the
header, i.e., objects consisting of only a header are not supported.
However, if the header size is larger than or equal to alignment, the
pad method must still be able to create padding objects down to
alignment size.</p>

<p>At the moment, this format only works with pool classes AMC and AMCZ.</p>

<h2><a id="section-A" name="section-A">A. References</a></h2>

<h2><a id="section-B" name="section-B">B. Document History</a></h2>

<table>

<tr valign="top">

  <td>2000-07-17 12:48:28 +01</td>

  <td>pekka</td>

  <td>New document saved</td>

</tr>

<tr valign="top">

  <td>2000-07-17 17:07:12 +01</td>

  <td>pekka</td>

  <td>explain header</td>

</tr>

<tr valign="top">

  <td>2000-07-27 12:49:20 +01</td>

  <td>pekka</td>

  <td>note object size</td>

</tr>

<tr valign="top">

  <td>2000-07-31 19:50:15 +01</td>

  <td>pekka</td>

  <td>note AMC</td>

</tr>

<tr valign="top">

  <td>2000-07-31 19:50:32 +01</td>

  <td>pekka</td>

  <td>note AMCZ</td>

</tr>

<tr valign="top">

  <td>2001-09-26</td>

  <td><a href="mailto:ndl@ravenbrook.com">NDL</a></td>

  <td>Converted from xml to html (second pass).</td>

</tr>

<tr valign="top">

  <td>2002-04-15</td>

  <td><a href="mailto:nb@ravenbrook.com">NB</a></td>

  <td>Reformatted and adopted.</td>

</tr>

</table>

<hr />

<p><small>Copyright &copy; 2001 Ravenbrook Limited.  This document is
provided "as is", without any express or implied warranty.  In no
event will the authors be held liable for any damages arising from the
use of this document.  You may not duplicate or reproduce this
document in any form without the express permission of the copyright
holder.</small></p>

<div align="center">

<p><code>$Id$</code></p>

</div>

</body>

</html>

