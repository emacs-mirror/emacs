<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">



 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>

  <head>

   <title>MPS C Interface: function mps_root_create_table_masked</title>

  </head>

  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>

   <div align='center'>

    <h1>MPS C Interface: function mps_root_create_table_masked</h1>

    <p>draft</p>

    <address>pekka, 1997-09-24</address>

   </div>

   <h2>

    <a id='section-name' name='section-name'>Name</a>

   </h2>

   <p>mps_root_create_table_masked</p>

   <h2>

    <a id='section-summary' name='section-summary'>Summary</a>

   </h2>

   <p>

    "

    mps_root_create_table

    _masked

    " creates a root that is a vector of tagged values.

   </p>

   <h2>

    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>

   </h2>

   <p>Root.</p>

   <h2>

    <a id='section-syntax' name='section-syntax'>Syntax</a>

   </h2>

   <p>

    mps_res_t mps_root_create_table_masked(mps_root_t *root_o,

    <br />

                                           mps_arena_t arena,

                                       mps_rank_t rank,

    <br />

                                           mps_rm_t rm,

                                       mps_addr_t *base, size_t size,

    <br />

                                           mps_word_t mask);

   </p>

   <h2>

    <a id='section-arguments' name='section-arguments'>Arguments</a>

   </h2>

   <p>root_o    a pointer to a variable for storing the new root structure in</p>

   <p>arena     the arena</p>

   <p>rank      the rank of the references in this root</p>

   <p>rm        the root mode</p>

   <p>base      a pointer to the vector of references that is being registered</p>

   <p>

    size      the number of references in the vector being registered

    <br />

    mask      any element that has any of the bits in mask set is ignored

   </p>

   <h2>

    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>

   </h2>

   <p>If the return value is "MPS_RES_OK", the new root in "*root_o".</p>

   <h2>

    <a id='section-resources' name='section-resources'>Resources</a>

   </h2>

   <p>mps.h</p>

   <h2>

    <a id='section-description' name='section-description'>Description</a>

   </h2>

   <p>

    "

    mps_root_create_table_masked" creates a root that is a table of tagged values.  The mask parameter indicates which bits of a pointer are tag bits.  References are assumed to have a tag of zero, values with other tags are ignored.

    <br />

   </p>

   <p>If the rank of the root is not "MPS_RANK_AMBIG", the contents of the root have to be valid whenever a GC happens, i.e., they have to be references to actual objects or "NULL".  If you're using asynchronous GC, this could be right after the root is registered, so the root has to be valid when it is registered.  It's OK for a root to have entries which point to memory not managed by the MPS -- they will simply be ignored.</p>

   <h2>

    <a id='section-example' name='section-example'>Example</a>

   </h2>

   <p>#define tagMASK 0x0003</p>

   <p>

    <br />

    static mps_root_t mmRoot;

   </p>

   <p>Object *Objects[rootCOUNT];</p>

   <p>int main(void)</p>

   <p>{</p>

   <p>  mps_res_t res;</p>

   <p>  /* ... */</p>

   <p>

      res = mps_root_create_table_masked (&amp;mmRoot, arena, MPS_RANK_EXACT, (mps_rm_t)0,

    <br />

                                          (mps_addr_t)&amp;Objects, rootCOUNT,

   </p>

   <p>                                      (mps_word_t)tagMASK);</p>

   <p>  if(res != MPS_RES_OK) exit(1);</p>

   <p>  /* ... */</p>

   <p>}</p>

   <h2>

    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>

   </h2>

   <p>

    "mps_root_create

    _table_masked

    " returns "MPS_RES_MEMORY" when it fails to allocate memory for the internal root structure; you need to deallocate or reclaim something to make enough space, or expand the arena.

   </p>

   <h2>

    <a id='section-see-also' name='section-see-also'>See Also</a>

   </h2>

   <p>

    mps_root_create_table

    , MPS_RM_PROT, MPS_RM_PROT_INNER, MPS_RM_CONST

   </p>

   <h2>

    <a id='section-A' name='section-A'>A. References</a>

   </h2>

   <h2>

    <a id='section-B' name='section-B'>B. Document History</a>

   </h2>

   <table>

    <tr valign='top'>

     <td>1997-09-24 12:23:50 +01</td>

     <td>pekka</td>

     <td>New document saved</td>

    </tr>

    <tr valign='top'>

     <td>1997-10-07 12:49:47 -04</td>

     <td>lmb</td>

     <td>Added "_masked" to document title</td>

    </tr>

    <tr valign='top'>

     <td>1998-01-23 15:41:33 +00</td>

     <td>pekka</td>

     <td>added missing sections</td>

    </tr>

    <tr valign='top'>

     <td>1998-01-26 18:15:20 +00</td>

     <td>pekka</td>

     <td>xref root modes; add validity gumph</td>

    </tr>

    <tr valign='top'>

     <td>2000-05-22 18:17:44 +01</td>

     <td>pekka</td>

     <td>fix title</td>

    </tr>

    <tr valign='top'>

     <td>2001-09-26</td>

     <td>

      <a href='mailto:ndl@ravenbrook.com'>NDL</a>

     </td>

     <td>Converted from xml to html (second pass).</td>

    </tr>

   </table>

   <hr />

   <p>

    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>

   </p>

   <div align='center'>

    <p>

     <code>$Id$</code>

    </p>

   </div>

  </body>

 </html>

