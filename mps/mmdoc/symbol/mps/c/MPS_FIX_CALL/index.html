<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">



 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>

  <head>

   <title>MPS C Interface: macro MPS_FIX_CALL</title>

  </head>

  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>

   <div align='center'>

    <h1>MPS C Interface: macro MPS_FIX_CALL</h1>

    <p>draft</p>

    <address>pekka, 1998-01-19</address>

   </div>

   <h2>

    <a id='section-name' name='section-name'>Name</a>

   </h2>

   <p>MPS_FIX_CALL</p>

   <h2>

    <a id='section-summary' name='section-summary'>Summary</a>

   </h2>

   <p>

    MPS_FIX_CALL is used to call a scanning function from within 

    MPS_SCAN_BEGIN and MPS_SCAN_END.

    <br />

   </p>

   <h2>

    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>

   </h2>

   <p>Scanning.</p>

   <h2>

    <a id='section-syntax' name='section-syntax'>Syntax</a>

   </h2>

   <p>MPS_FIX_CALL(ss, call);</p>

   <h2>

    <a id='section-arguments' name='section-arguments'>Arguments</a>

   </h2>

   <p>mps_ss    the scan state argument that was passed to the scanning function</p>

   <p>call      an expression (containing a call to a scanning function)</p>

   <h2>

    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>

   </h2>

   <p>None.</p>

   <h2>

    <a id='section-resources' name='section-resources'>Resources</a>

   </h2>

   <p>mps.h.</p>

   <h2>

    <a id='section-description' name='section-description'>Description</a>

   </h2>

   <p>

    When using the 

    MPS_SCAN_BEGIN and MPS_SCAN_END 

    macros, you can't directly call a separate function to do part of the scanning, because between

     MPS_SCAN_BEGIN and MPS_SCAN_END

    , the scan_state parameter is in a strange state, so you shouldn't pass it as an argument to a function.  However, if really want to do it (say, because you have an embedded structure shared between two scan methods), you can pass the scan state correctly using MPS_FIX_CALL.

    <br />

   </p>

   <p>Note that you must receive the return value of the scanning function called, and pass it on as described in the ERROR HANDLING section.</p>

   <h2>

    <a id='section-example' name='section-example'>Example</a>

   </h2>

   <p>

    <pre>mps_res_t foo_scan(mps_ss_t scan_state, mps_addr_t base, mps_addr_t limit)

{

  Object *obj;

  Object *obj_limit;

  mps_res_t res;

  obj_limit = limit;

  MPS_SCAN_BEGIN(scan_state)

    for(obj = base; obj &lt; obj_limit; obj++) {

      if(MPS_FIX12(scan_state, &amp;obj-&gt;left) != MPS_RES_OK)

        return res;

      MPS_FIX_CALL(scan_state,

                   res = scan_data(scan_state, &amp;obj-&gt;data));

      if(res != MPS_RES_OK) return res;

      if(MPS_FIX12(scan_state, &amp;obj-&gt;right) != MPS_RES_OK)

        return res;

    }

  MPS_SCAN_END(scan_state);

  return MPS_RES_OK;

}</pre>

   </p>

   <h2>

    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>

   </h2>

   <p>

    You must receive the return value of the function called

    .  Like all scanning functions,

     it returns 

    <code>MPS_RES_OK</code>

     if it was successful, in which case the caller should continue to scan the rest of the object, fixing the remaining references.  If it returns a value other than 

    <code>MPS_RES_OK</code>

    , the calling scanning function must return that value, and may return without scanning further references.  Generally, it is better if it returns as soon as possible.

    <br />

   </p>

   <h2>

    <a id='section-see-also' name='section-see-also'>See Also</a>

   </h2>

   <p>

    mps_fix, mps_ss_t, mps_root_scan_t, mps_fmt_scan_t, mps_reg_scan_t, MPS_SCAN_BEGIN, MPS_SCAN_END

    , MPS_FIX12

    , MPS_FIX1, MPS_FIX2

   </p>

   <h2>

    <a id='section-A' name='section-A'>A. References</a>

   </h2>

   <h2>

    <a id='section-B' name='section-B'>B. Document History</a>

   </h2>

   <table>

    <tr valign='top'>

     <td>1998-01-19 14:29:39 +00</td>

     <td>pekka</td>

     <td>New document saved</td>

    </tr>

    <tr valign='top'>

     <td>1998-01-19 14:30:03 +00</td>

     <td>pekka</td>

     <td>fix tag</td>

    </tr>

    <tr valign='top'>

     <td>1998-01-20 13:57:10 +00</td>

     <td>pekka</td>

     <td>fix bug in example</td>

    </tr>

    <tr valign='top'>

     <td>2000-06-06 15:40:07 +01</td>

     <td>pekka</td>

     <td>MPS_FIX12</td>

    </tr>

    <tr valign='top'>

     <td>2001-09-26</td>

     <td>

      <a href='mailto:ndl@ravenbrook.com'>NDL</a>

     </td>

     <td>Converted from xml to html (second pass).</td>

    </tr>

   </table>

   <hr />

   <p>

    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>

   </p>

   <div align='center'>

    <p>

     <code>$Id$</code>

    </p>

   </div>

  </body>

 </html>

