<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">



 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>

  <head>

   <title>MPS C Interface: function mps_finalize</title>

  </head>

  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>

   <div align='center'>

    <h1>MPS C Interface: function mps_finalize</h1>

    <p>incomplete</p>

    <address>lmb, 1997-10-07</address>

   </div>

   <h2>

    <a id='section-name' name='section-name'>Name</a>

   </h2>

   <p>

    mps_finalize

    <br />

   </p>

   <h2>

    <a id='section-summary' name='section-summary'>Summary</a>

   </h2>

   <p>Registers an object for finalization.</p>

   <h2>

    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>

   </h2>

   <p>

    Finalization, message.

    <br />

   </p>

   <h2>

    <a id='section-syntax' name='section-syntax'>Syntax</a>

   </h2>

   <p>

    mps_res_t mps_finalize(mps_arena_t arena, mps_addr_t *object_ref)

    <br />

   </p>

   <h2>

    <a id='section-arguments' name='section-arguments'>Arguments</a>

   </h2>

   <p>

    <code>arena</code>

     -- the arena in which the object lives

   </p>

   <p>

    <code>object_ref</code>

     -- a pointer to a pointer to the object to be finalized

    <br />

   </p>

   <h2>

    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>

   </h2>

   <p>A result code.</p>

   <h2>

    <a id='section-resources' name='section-resources'>Resources</a>

   </h2>

   <p>mps.h</p>

   <h2>

    <a id='section-description' name='section-description'>Description</a>

   </h2>

   <p>This function registers the specified object for finalization.  This object must be an object allocated from a pool in the specified arena.</p>

   <p>An object becomes finalizable if it is registered for finalization, and the collector observes that it would otherwise be reclaimable.  Note that the subsequent creation of strong references to the object (from, say, weak references) may cause finalization to occur when an object is not otherwise reclaimable.</p>

   <p>When an object is finalizable, it may be finalized up to N times, where N is the number of times it has been registered for finalization.  When an object is finalized, it is also deregistered for finalization (so that it cannot be finalized again from the same registration).</p>

   <p>

    Finalization is performed by passing a finalization message to the client, containing an exact reference to the object.  See the message protocol, 

    <code>mps_message_type_finalization</code>

    , and 

    <code>mps_message_finalization_ref</code>

     for details.

   </p>

   <p>If an object is registered for finalization multiple times, then there may be multiple finalization messages on the queue at the same time.  It may also be necessary to discard previous finalization messages for an object before all such messages are posted on the message queue.  Clients performing multiple registrations must cope with both behaviors.</p>

   <p>Note that there is no guarantee that finalization will be prompt, although the collector does attempt to do this.</p>

   <p>

    Note that there will be no attempt to finalize objects in the context of 

    <code>mps_arena_destroy</code>

     or 

    <code>mps_pool_destroy</code>

    .  

    <code>mps_pool_destroy</code>

     should therefore not be invoked on pools containing objects registered for finalization.

   </p>

   <p>Not all pools support finalization of objects in those pools.  For more information, see the Pool Class Catalog.</p>

   <h2>

    <a id='section-example' name='section-example'>Example</a>

   </h2>

   <p>[missing]</p>

   <h2>

    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>

   </h2>

   <p>[missing]</p>

   <h2>

    <a id='section-see-also' name='section-see-also'>See Also</a>

   </h2>

   <p>

    mps_message_*, mps_arena_destroy, mps_pool_destroy

    <br />

   </p>

   <h2>

    <a id='section-notes' name='section-notes'>Notes</a>

   </h2>

   <p>This function receives a pointer to a reference.  This is to avoid placing the restriction on the client that the C call stack be a root.</p>

   <h2>

    <a id='section-A' name='section-A'>A. References</a>

   </h2>

   <h2>

    <a id='section-B' name='section-B'>B. Document History</a>

   </h2>

   <table>

    <tr valign='top'>

     <td>1997-10-07 12:22:45 -04</td>

     <td>lmb</td>

     <td>New document saved</td>

    </tr>

    <tr valign='top'>

     <td>1997-10-08 12:39:04 -04</td>

     <td>lmb</td>

     <td>Corrected one of the Argument entries</td>

    </tr>

    <tr valign='top'>

     <td>1997-10-09 14:10:40 -04</td>

     <td>lmb</td>

     <td>Added entry for Returned Values</td>

    </tr>

    <tr valign='top'>

     <td>1997-10-14 15:14:22 -04</td>

     <td>lmb</td>

     <td>Added comments from DRJ</td>

    </tr>

    <tr valign='top'>

     <td>1997-10-28 12:26:49 -05</td>

     <td>lmb</td>

     <td>Edited for formatting and clarity (quotes around symbol names, etc.)</td>

    </tr>

    <tr valign='top'>

     <td>2000-05-22 16:25:46 +01</td>

     <td>pekka</td>

     <td>clean up</td>

    </tr>

    <tr valign='top'>

     <td>2000-10-05 19:15:26 +01</td>

     <td />

     <td>clean up</td>

    </tr>

    <tr valign='top'>

     <td>2000-10-05 19:16:13 +01</td>

     <td>pekka</td>

     <td>new format</td>

    </tr>

    <tr valign='top'>

     <td>2001-09-26</td>

     <td>

      <a href='mailto:ndl@ravenbrook.com'>NDL</a>

     </td>

     <td>Converted from xml to html (second pass).</td>

    </tr>

   </table>

   <hr />

   <p>

    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>

   </p>

   <div align='center'>

    <p>

     <code>$Id$</code>

    </p>

   </div>

  </body>

 </html>

