<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">



 <html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>

  <head>

   <title>MPS C Interface: type mps_root_scan_t</title>

  </head>

  <body bgcolor='#FFFFFF' text='#000000' link='#000099' vlink='#660066' alink='#FF0000'>

   <div align='center'>

    <h1>MPS C Interface: type mps_root_scan_t</h1>

    <p>draft</p>

    <address>pekka, 1998-01-21</address>

   </div>

   <h2>

    <a id='section-name' name='section-name'>Name</a>

   </h2>

   <p>

    mps_root_scan_t

    <br />

   </p>

   <h2>

    <a id='section-summary' name='section-summary'>Summary</a>

   </h2>

   <p>

    Type of root scanning functions for 

    <code>mps_root_create</code>

    .

   </p>

   <h2>

    <a id='section-associated-protocols' name='section-associated-protocols'>Associated Protocols</a>

   </h2>

   <p>Root.</p>

   <h2>

    <a id='section-syntax' name='section-syntax'>Syntax</a>

   </h2>

   <p>

    <pre>typedef mps_res_t (*mps_root_scan_t)(mps_ss_t scan_state, void * p, size_t s)</pre>

   </p>

   <h2>

    <a id='section-arguments' name='section-arguments'>Arguments</a>

   </h2>

   <p>

    <code>scan_state</code>

      a scan state

   </p>

   <p>

    <code>p</code>

                 an argument passed through from 

    <code>mps_root_create</code>

   </p>

   <p>

    <code>s</code>

                 an argument passed through from 

    <code>mps_root_create</code>

   </p>

   <h2>

    <a id='section-returned-values' name='section-returned-values'>Returned Values</a>

   </h2>

   <p>A result code.</p>

   <h2>

    <a id='section-resources' name='section-resources'>Resources</a>

   </h2>

   <p>mps.h</p>

   <h2>

    <a id='section-description' name='section-description'>Description</a>

   </h2>

   <p>

    This is the type of root scanning functions the client provides to 

    <code>mps_root_create</code>

    .  The MPS will call these functions

     whenever the root needs to be scanned,

     with a scan state (of type 

    <code>mps_ss_t</code>

    ), and the 

    <code>p</code>

     and 

    <code>s</code>

     values specified in the call to 

    <code>mps_root_create</code>

    .  Apart from the argument list, the scanning function works like the format scan methods: it needs to indicate all references using 

    <code>mps_fix</code>

     or 

    <code>MPS_FIX*</code>

    .

   </p>

   <h2>

    <a id='section-example' name='section-example'>Example</a>

   </h2>

   <p>

    <pre>static StackFrame *stackBottom;

/* root scanner for an imaginary interpreter for a stack-oriented language */

static mps_res_t rootScanner(mps_ss_t ss, void * p, size_t s)

{

StackFrame *frame;

  size_t i;

  mps_res_t res;

  UNUSED(p); UNUSED(s);

  for(frame = stackBottom; frame != NULL; frame = frame-&gt;next)

    for(i = frame-&gt;size; i &gt; 0; --i) {

      res = mps_fix(ss, &amp;frame-&gt;locals[i]);

if(res != MPS_RES_OK) return res;

   }

  return res;

}</pre>

   </p>

   <h2>

    <a id='section-error-handling' name='section-error-handling'>Error Handling</a>

   </h2>

   <p>

    If 

    a fixing operation

     returns a value other than 

    <code>MPS_RES_OK</code>

    , the scanning function must return that value, and may return without scanning further references.  Generally, it is better if it returns as soon as possible.  If the scanning is completed successfully, the function should return 

    <code>MPS_RES_OK</code>

    .

    <br />

   </p>

   <h2>

    <a id='section-see-also' name='section-see-also'>See Also</a>

   </h2>

   <p>

    mps_root_create

    , mps_ss_t

    , mps_fix

    , 

    MPS_SCAN_BEGIN, MPS_SCAN_END, MPS_FIX12, MPS_FIX1, MPS_FIX2, MPS_FIX_CALL

    , 

    mps_fmt_scan_t

   </p>

   <h2>

    <a id='section-A' name='section-A'>A. References</a>

   </h2>

   <h2>

    <a id='section-B' name='section-B'>B. Document History</a>

   </h2>

   <table>

    <tr valign='top'>

     <td>1998-01-21 17:50:14 +00</td>

     <td>pekka</td>

     <td>New document saved</td>

    </tr>

    <tr valign='top'>

     <td>1998-01-22 12:05:34 +00</td>

     <td>pekka</td>

     <td>finished first draft</td>

    </tr>

    <tr valign='top'>

     <td>1998-01-23 19:48:47 +00</td>

     <td>pekka</td>

     <td>fix typos</td>

    </tr>

    <tr valign='top'>

     <td>2000-05-22 17:21:37 +01</td>

     <td>pekka</td>

     <td>clean up</td>

    </tr>

    <tr valign='top'>

     <td>2000-06-06 15:43:48 +01</td>

     <td>pekka</td>

     <td>MPS_FIX12</td>

    </tr>

    <tr valign='top'>

     <td>2000-07-19 20:15:05 +01</td>

     <td>pekka</td>

     <td>add arguments and return value</td>

    </tr>

    <tr valign='top'>

     <td>2001-09-26</td>

     <td>

      <a href='mailto:ndl@ravenbrook.com'>NDL</a>

     </td>

     <td>Converted from xml to html (second pass).</td>

    </tr>

   </table>

   <hr />

   <p>

    <small>Copyright &copy; 2001 Ravenbrook Limited.  This document is provided "as is", without any express or implied warranty.  In no event will the authors be held liable for any damages arising from the use of this document.  You may not duplicate or reproduce this document in any form without the express permission of the copyright holder.</small>

   </p>

   <div align='center'>

    <p>

     <code>$Id$</code>

    </p>

   </div>

  </body>

 </html>

