

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5. Tuning the Memory Pool System for performance &mdash; Memory Pool System 1.111.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/mps.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.111.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Memory Pool System 1.111.0 documentation" href="../index.html" />
    <link rel="up" title="Guide" href="index.html" />
    <link rel="next" title="6. Advanced topics" href="advanced.html" />
    <link rel="prev" title="4. Debugging with the Memory Pool System" href="debug.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="advanced.html" title="6. Advanced topics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="debug.html" title="4. Debugging with the Memory Pool System"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tuning-the-memory-pool-system-for-performance">
<span id="guide-perf"></span><span id="index-0"></span><h1>5. Tuning the Memory Pool System for performance<a class="headerlink" href="#tuning-the-memory-pool-system-for-performance" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">When developing a benchmark to profile your program against, bear
in mind that the benchmark should allocate several times the
amount of physical memory that you expect to be available to the
process. If the total allocation fits into the available memory,
there&#8217;s no point running a garbage collector at all: you might as
well just allocate and never collect.</p>
</div>
<p>The most important aspect of tuning the MPS is to choose good sizes
for the <a class="reference internal" href="../glossary/g.html#term-generation"><em class="xref std std-term">generations</em></a> in your <a class="reference internal" href="../glossary/g.html#term-generation-chain"><em class="xref std std-term">generation chain</em></a>. The
ideal size of a generation should be such that when it is collected,
most of the blocks allocated in that generation should be found to be
<a class="reference internal" href="../glossary/d.html#term-dead"><em class="xref std std-term">dead</em></a> (and so the cost of <a class="reference internal" href="../glossary/s.html#term-scan"><em class="xref std std-term">scanning</em></a> and
<a class="reference internal" href="../glossary/c.html#term-copying-garbage-collection"><em class="xref std std-term">copying</em></a> them can be avoided
entirely). If a generation is collected when its blocks are mostly
alive, that is a waste of time.</p>
<p>In the table below I give the execution time of <tt class="docutils literal"><span class="pre">test-leaf.scm</span></tt> in
the toy Scheme interpreter under different settings for its generation
chain. (This test case allocates millions of small short-lived
objects.) In each case the AMC pool is given a chain with a single
generation with the specified capacity and mortality.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="21%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Capacity</th>
<th class="head">Mortality</th>
<th class="head">Execution time (user+sys)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>100</td>
<td>0.80</td>
<td>39.9</td>
</tr>
<tr class="row-odd"><td>200</td>
<td>0.80</td>
<td>30.2</td>
</tr>
<tr class="row-even"><td>400</td>
<td>0.80</td>
<td>25.5</td>
</tr>
<tr class="row-odd"><td>800</td>
<td>0.80</td>
<td>16.3</td>
</tr>
<tr class="row-even"><td>1600</td>
<td>0.80</td>
<td>9.0</td>
</tr>
<tr class="row-odd"><td>3200</td>
<td>0.80</td>
<td>5.8</td>
</tr>
<tr class="row-even"><td>6400</td>
<td>0.20</td>
<td>4.2</td>
</tr>
<tr class="row-odd"><td>6400</td>
<td>0.40</td>
<td>4.1</td>
</tr>
<tr class="row-even"><td>6400</td>
<td>0.60</td>
<td>4.1</td>
</tr>
<tr class="row-odd"><td>6400</td>
<td>0.80</td>
<td>4.1</td>
</tr>
<tr class="row-even"><td>6400</td>
<td>0.99</td>
<td>4.2</td>
</tr>
<tr class="row-odd"><td>12800</td>
<td>0.80</td>
<td>4.2</td>
</tr>
<tr class="row-even"><td>25600</td>
<td>0.80</td>
<td>5.2</td>
</tr>
</tbody>
</table>
<p>This table suggests that:</p>
<ol class="arabic simple">
<li>The improvement in performance to be gained by getting generation
sizes right is dramatic: much bigger than the small improvements to
gained from other techniques.</li>
<li>The predicted mortality doesn&#8217;t make much difference to the overall
execution time (it does affect the distribution of pause times,
however: see <a class="reference internal" href="../topic/collection.html#topic-collection-schedule"><em>Scheduling of collections</em></a>.)</li>
<li>You can make generations too big as well as too small.</li>
</ol>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="../topic/telemetry.html#topic-telemetry"><em>Telemetry</em></a> can be used to discover when generations
are being collected and what proportion of blocks were found to be
alive.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="debug.html"
                        title="previous chapter">4. Debugging with the Memory Pool System</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="advanced.html"
                        title="next chapter">6. Advanced topics</a></p><h4>Contact us</h4>

<p class="topless"><a href="mailto:mps-questions@ravenbrook.com">mps-questions@ravenbrook.com</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="advanced.html" title="6. Advanced topics"
             >next</a> |</li>
        <li class="right" >
          <a href="debug.html" title="4. Debugging with the Memory Pool System"
             >previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2012, Ravenbrook Limited.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>