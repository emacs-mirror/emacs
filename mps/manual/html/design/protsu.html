

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>32. SunOS 4 protection module &mdash; Memory Pool System 1.111.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/mps.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.111.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Memory Pool System 1.111.0 documentation" href="../index.html" />
    <link rel="up" title="Old design" href="old.html" />
    <link rel="next" title="33. Protocol inheritance" href="protocol.html" />
    <link rel="prev" title="31. Linux implementation of protection module" href="protli.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="protocol.html" title="33. Protocol inheritance"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="protli.html" title="31. Linux implementation of protection module"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="old.html" accesskey="U">Old design</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="sunos-4-protection-module">
<span id="design-protsu"></span><span id="index-0"></span><h1>32. SunOS 4 protection module<a class="headerlink" href="#sunos-4-protection-module" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning" id="design.mps.protsu">
<p class="first admonition-title">Warning</p>
<p class="last">As of 2013-05-26, the MPS is no longer supported on SunOS, so
this document is only of historical interest.</p>
</div>
<div class="section" id="introduction">
<h2>32.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><span class="target" id="design.mps.protsu.readership"></span><a class="mpstag reference internal" href="#design.mps.protsu.readership">.readership:</a> Any MPS developer.</p>
<p><span class="target" id="design.mps.protsu.intro"></span><a class="mpstag reference internal" href="#design.mps.protsu.intro">.intro:</a> This is the design of the SunOS 4 implementation of the
protection module. It is intended to be used only in SunOS 4 (os.su).
It makes use of various services provided by SunOS 4.</p>
</div>
<div class="section" id="requirements">
<h2>32.2. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p><span class="target" id="design.mps.protsu.req.general"></span><a class="mpstag reference internal" href="#design.mps.protsu.req.general">.req.general:</a> Required to implement the general protection
interface defined in design.mps.prot.if.*.</p>
</div>
<div class="section" id="overview">
<h2>32.3. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Uses <tt class="xref c c-func docutils literal"><span class="pre">mprotect()</span></tt>.</p>
</div>
<div class="section" id="misc">
<h2>32.4. Misc<a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h2>
<p><span class="target" id="design.mps.protsu.improve.sig-stack"></span><a class="mpstag reference internal" href="#design.mps.protsu.improve.sig-stack">.improve.sig-stack:</a> Currently we do not handle signals on a
separate signal stack. If we handled signals on our own stack then we
could guarantee not to run out of stack while we were handling the
signal. This would be useful (it may even be required). We would have
to use <tt class="docutils literal"><span class="pre">sigvec(2)</span></tt> rather than <tt class="docutils literal"><span class="pre">signal(3)</span></tt> (set the <tt class="xref c c-macro docutils literal"><span class="pre">SV_ONSTACK</span></tt>
flag and use <tt class="docutils literal"><span class="pre">sigstack(2)</span></tt>). This has drawbacks as the signal stack
is not grown automatically, so we would have to to frig the stacks
back if we wanted to pass on the signal to some other handler as that
handler may require arbitrary amounts of stack.</p>
<p><span class="target" id="design.mps.protsu.improve.sigvec"></span><a class="mpstag reference internal" href="#design.mps.protsu.improve.sigvec">.improve.sigvec:</a> Note 1 of <a class="reference internal" href="prot.html#ProtSetup" title="ProtSetup"><tt class="xref c c-func docutils literal"><span class="pre">ProtSetup()</span></tt></a> notes that we can&#8217;t
honour the <tt class="docutils literal"><span class="pre">sigvec(2)</span></tt> entries of the next handler in the chain.
What if when we want to pass on the signal instead of calling the
handler we call <tt class="xref c c-func docutils literal"><span class="pre">sigvec()</span></tt> with the old entry and use kill to send
the signal to ourselves and then restore our handler using sigvec
again.</p>
</div>
<div class="section" id="data-structures">
<h2>32.5. Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h2>
<p><span class="target" id="design.mps.protsu.data.signext"></span><a class="mpstag reference internal" href="#design.mps.protsu.data.signext">.data.signext:</a> This is static. Because that is the only
communications channel available to signal handlers. [write a little
more here]</p>
</div>
<div class="section" id="functions">
<h2>32.6. Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p><span class="target" id="design.mps.protsu.fun.setup"></span><a class="mpstag reference internal" href="#design.mps.protsu.fun.setup">.fun.setup:</a> <a class="reference internal" href="prot.html#ProtSetup" title="ProtSetup"><tt class="xref c c-func docutils literal"><span class="pre">ProtSetup()</span></tt></a>. The setup involves installing a signal
handler for the signal <tt class="xref c c-macro docutils literal"><span class="pre">SIGSEGV</span></tt> to catch and handle protection
faults (this handler is the function <tt class="xref c c-func docutils literal"><span class="pre">sigHandle()</span></tt>, see
<a class="reference internal" href="#design.mps.protsu.fun.sighandle">.fun.sighandle</a>). The previous handler is recorded (in the variable
<tt class="docutils literal"><span class="pre">sigNext</span></tt>, see <a class="reference internal" href="#design.mps.protsu.data.signext">.data.signext</a>) so that it can be reached from
<tt class="xref c c-func docutils literal"><span class="pre">sigHandle()</span></tt> if it fails to handle the fault.</p>
<p>The problem with this approach is that we can&#8217;t honor the wishes of the
<tt class="docutils literal"><span class="pre">sigvec(2)</span></tt> entry for the previous handler (in terms of masks in particular).</p>
<p>Obviously it would be okay to always chain the previous signal handler
onto <tt class="docutils literal"><span class="pre">sigNext</span></tt>, however in the case where the previous handler is
the one we&#8217;ve just installed (that is, <tt class="docutils literal"><span class="pre">sigHandle</span></tt>) then it is not
necessary to chain the handler, so we don&#8217;t.</p>
<p><span class="target" id="design.mps.protsu.fun.set"></span><a class="mpstag reference internal" href="#design.mps.protsu.fun.set">.fun.set:</a> <a class="reference internal" href="prot.html#ProtSet" title="ProtSet"><tt class="xref c c-func docutils literal"><span class="pre">ProtSet()</span></tt></a></p>
<p><span class="target" id="design.mps.protsu.fun.set.convert"></span><a class="mpstag reference internal" href="#design.mps.protsu.fun.set.convert">.fun.set.convert:</a> The requested protection (which is expressed in
the mode parameter, see design.mps.prot.if.set) is translated into an
operating system protection. If read accesses are to be forbidden then
all accesses are forbidden, this is done by setting the protection of
the page to <tt class="xref c c-macro docutils literal"><span class="pre">PROT_NONE</span></tt>. If write access are to be forbidden (and
not read accesses) then write accesses are forbidden and read accesses
are allowed, this is done by setting the protection of the page to
<tt class="docutils literal"><span class="pre">PROT_READ</span> <span class="pre">|</span> <span class="pre">PROT_EXEC</span></tt>. Otherwise (all access are okay), the
protection is set to <tt class="docutils literal"><span class="pre">PROT_READ</span> <span class="pre">|</span> <span class="pre">PROT_WRITE</span> <span class="pre">|</span> <span class="pre">PROT_EXEC</span></tt>.</p>
<p><span class="target" id="design.mps.protsu.fun.set.assume.mprotect"></span><a class="mpstag reference internal" href="#design.mps.protsu.fun.set.assume.mprotect">.fun.set.assume.mprotect:</a> We assume that the call to <tt class="xref c c-func docutils literal"><span class="pre">mprotect()</span></tt>
always succeeds. This is because we should always call the function
with valid arguments (aligned, references to mapped pages, and with an
access that is compatible with the access of the underlying object).</p>
<p><span class="target" id="design.mps.protsu.fun.sync"></span><a class="mpstag reference internal" href="#design.mps.protsu.fun.sync">.fun.sync:</a> <a class="reference internal" href="prot.html#ProtSync" title="ProtSync"><tt class="xref c c-func docutils literal"><span class="pre">ProtSync()</span></tt></a>. This does nothing in this implementation
as ProtSet sets the protection without any delay.</p>
<p><span class="target" id="design.mps.protsu.fun.tramp"></span><a class="mpstag reference internal" href="#design.mps.protsu.fun.tramp">.fun.tramp:</a> <a class="reference internal" href="prot.html#ProtTramp" title="ProtTramp"><tt class="xref c c-func docutils literal"><span class="pre">ProtTramp()</span></tt></a>. The protection trampoline is trivial
under SunOS, as there is nothing that needs to be done in the dynamic
context of the mutator in order to catch faults. (Contrast this with
Win32 Structured Exception Handling.)</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">32. SunOS 4 protection module</a><ul>
<li><a class="reference internal" href="#introduction">32.1. Introduction</a></li>
<li><a class="reference internal" href="#requirements">32.2. Requirements</a></li>
<li><a class="reference internal" href="#overview">32.3. Overview</a></li>
<li><a class="reference internal" href="#misc">32.4. Misc</a></li>
<li><a class="reference internal" href="#data-structures">32.5. Data structures</a></li>
<li><a class="reference internal" href="#functions">32.6. Functions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="protli.html"
                        title="previous chapter">31. Linux implementation of protection module</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="protocol.html"
                        title="next chapter">33. Protocol inheritance</a></p><h4>Downloads</h4>

<p class="topless">
<a href="http://www.ravenbrook.com/project/mps/release/1.111.0/">MPS Kit release 1.111.0</a><br>
<a href="http://www.ravenbrook.com/project/mps/release/">All MPS Kit releases</a>
</p>

<h4>Issues</h4>

<p class="topless">
<a href="http://www.ravenbrook.com/project/mps/issue/?action=list&amp;view=status%3dopen&amp;display=Job:Priority:Title&amp;sort=Priority">Known issues</a><br>
<a href="http://www.ravenbrook.com/project/mps/issue/?action=fixed&release_fixed=1.111.0">Issues fixed in release 1.111.0</a>
</p><h4>Contact us</h4>

<p class="topless"><a href="mailto:mps-questions@ravenbrook.com">mps-questions@ravenbrook.com</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="protocol.html" title="33. Protocol inheritance"
             >next</a> |</li>
        <li class="right" >
          <a href="protli.html" title="31. Linux implementation of protection module"
             >previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="old.html" >Old design</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2013, Ravenbrook Limited.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>