

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>15. The protection module &mdash; Memory Pool System 1.111.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/mps.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.111.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Memory Pool System 1.111.0 documentation" href="../index.html" />
    <link rel="up" title="Old design" href="old.html" />
    <link rel="next" title="16. Protocol inheritance" href="protocol.html" />
    <link rel="prev" title="14. Manually-Managed Variable-Size First-Fit Pool" href="poolmvff.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="protocol.html" title="16. Protocol inheritance"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="poolmvff.html" title="14. Manually-Managed Variable-Size First-Fit Pool"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="old.html" accesskey="U">Old design</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-protection-module">
<span id="design-design-prot"></span><span id="design-prot"></span><span id="index-0"></span><h1>15. The protection module<a class="headerlink" href="#the-protection-module" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="design.mps.prot"></span><h2>15.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><span class="target" id="design.mps.prot.intro"></span><a class="mpstag reference internal" href="#design.mps.prot.intro">.intro:</a> This is the generic design of the Protection Module. The
protection module provides protection services to other parts of the
MPS. It is expected that different operating systems will have
different implementations of this module.</p>
<p><span class="target" id="design.mps.prot.readership"></span><a class="mpstag reference internal" href="#design.mps.prot.readership">.readership:</a> Any MPS developer.</p>
</div>
<div class="section" id="interface">
<h2>15.2. Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ProtSetup">
void <tt class="descname">ProtSetup</tt><big>(</big>void<big>)</big><a class="headerlink" href="#ProtSetup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><span class="target" id="design.mps.prot.if.setup"></span><a class="mpstag reference internal" href="#design.mps.prot.if.setup">.if.setup:</a> <a class="reference internal" href="#ProtSetup" title="ProtSetup"><tt class="xref c c-func docutils literal"><span class="pre">ProtSetup()</span></tt></a> will be called exactly once (per
process). It will be called as part of the initialization of the first
space that is created. It should arrange for the setup and
initialization of any datastructures or services that are necessary in
order to implement the protection module. (On UNIX it expected that it
will install a signal handler, on Windows it will do nothing)</p>
<dl class="function">
<dt id="ProtSet">
void <tt class="descname">ProtSet</tt><big>(</big><a class="reference internal" href="type.html#Addr" title="Addr">Addr</a><em>&nbsp;base</em>, <a class="reference internal" href="type.html#Addr" title="Addr">Addr</a><em>&nbsp;limit</em>, <a class="reference internal" href="type.html#AccessSet" title="AccessSet">AccessSet</a><em>&nbsp;mode</em><big>)</big><a class="headerlink" href="#ProtSet" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><span class="target" id="design.mps.prot.if.set"></span><a class="mpstag reference internal" href="#design.mps.prot.if.set">.if.set:</a> <a class="reference internal" href="#ProtSet" title="ProtSet"><tt class="xref c c-func docutils literal"><span class="pre">ProtSet()</span></tt></a> should set the protection of the memory
between base and limit, including base, but not including limit (ie
the half-open interval [base,limit)) to that specified by mode. The
mode parameter should have the <tt class="docutils literal"><span class="pre">AccessWRITE</span></tt> bit set if write
accesses to the page are to be forbidden, and should have the
<tt class="docutils literal"><span class="pre">AccessREAD</span></tt> bit set if read accesses to the page are to be
forbidden. A request to forbid read accesses (that is, <tt class="docutils literal"><span class="pre">AccessREAD</span></tt>
is set) may also forbid write accesses, but read accesses will not be
forbidden unless <tt class="docutils literal"><span class="pre">AccessREAD</span></tt> is set.</p>
<dl class="function">
<dt id="ProtTramp">
void <tt class="descname">ProtTramp</tt><big>(</big>void<em>&nbsp;**resultReturn</em>, void *(*f)(void<em>&nbsp;*</em>, size_t), void<em>&nbsp;*p</em>, size_t<em>&nbsp;s</em><big>)</big><a class="headerlink" href="#ProtTramp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><span class="target" id="design.mps.prot.if.tramp"></span><a class="mpstag reference internal" href="#design.mps.prot.if.tramp">.if.tramp:</a> [undocumented]</p>
<dl class="function">
<dt id="ProtSync">
void <tt class="descname">ProtSync</tt><big>(</big>Space<em>&nbsp;space</em><big>)</big><a class="headerlink" href="#ProtSync" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><span class="target" id="design.mps.prot.if.sync"></span><a class="mpstag reference internal" href="#design.mps.prot.if.sync">.if.sync:</a> <a class="reference internal" href="#ProtSync" title="ProtSync"><tt class="xref c c-func docutils literal"><span class="pre">ProtSync()</span></tt></a> is called to ensure that the actual
protection of each segment (as determined by the OS) is in accordance
with the segments&#8217;s <tt class="docutils literal"><span class="pre">pm</span></tt> field.</p>
<dl class="type">
<dt id="MutatorFaultContext">
struct MutatorFaultContextStruct *<tt class="descname">MutatorFaultContext</tt><a class="headerlink" href="#MutatorFaultContext" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><span class="target" id="design.mps.prot.if.context-type"></span><a class="mpstag reference internal" href="#design.mps.prot.if.context-type">.if.context-type:</a> This abstract type is implemented by the
protection module (impl.c.prot*). It represents the continuation of
the mutator which is restored after a mutator fault has been handled.
The functions <a class="reference internal" href="#ProtCanStepInstruction" title="ProtCanStepInstruction"><tt class="xref c c-func docutils literal"><span class="pre">ProtCanStepInstruction()</span></tt></a> (<a class="reference internal" href="#design.mps.prot.if.canstep">.if.canstep</a> below) and
<a class="reference internal" href="#ProtStepInstruction" title="ProtStepInstruction"><tt class="xref c c-func docutils literal"><span class="pre">ProtStepInstruction()</span></tt></a> (<a class="reference internal" href="#design.mps.prot.if.step">.if.step</a> below) inspect and manipulate
the context.</p>
<dl class="function">
<dt id="ProtCanStepInstruction">
<a class="reference internal" href="type.html#Bool" title="Bool">Bool</a> <tt class="descname">ProtCanStepInstruction</tt><big>(</big><a class="reference internal" href="#MutatorFaultContext" title="MutatorFaultContext">MutatorFaultContext</a><em>&nbsp;context</em><big>)</big><a class="headerlink" href="#ProtCanStepInstruction" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><span class="target" id="design.mps.prot.if.canstep"></span><a class="mpstag reference internal" href="#design.mps.prot.if.canstep">.if.canstep:</a> Examines the context to determine whether the
protection module can single-step the instruction which is causing the
fault. Should return <tt class="xref c c-macro docutils literal"><span class="pre">TRUE</span></tt> if and only if the instruction can be
single-stepped (that is, <a class="reference internal" href="#ProtStepInstruction" title="ProtStepInstruction"><tt class="xref c c-func docutils literal"><span class="pre">ProtStepInstruction()</span></tt></a> can be called).</p>
<dl class="function">
<dt id="ProtStepInstruction">
<a class="reference internal" href="type.html#Bool" title="Bool">Bool</a> <a class="reference internal" href="type.html#Res" title="Res">Res</a> <tt class="descname">ProtStepInstruction</tt><big>(</big><a class="reference internal" href="#MutatorFaultContext" title="MutatorFaultContext">MutatorFaultContext</a><em>&nbsp;context</em><big>)</big><a class="headerlink" href="#ProtStepInstruction" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><span class="target" id="design.mps.prot.if.step"></span><a class="mpstag reference internal" href="#design.mps.prot.if.step">.if.step:</a> Single-steps the instruction which is causing the fault.
This function should only be called if <a class="reference internal" href="#ProtCanStepInstruction" title="ProtCanStepInstruction"><tt class="xref c c-func docutils literal"><span class="pre">ProtCanStepInstruction()</span></tt></a>
applied to the context returned <tt class="xref c c-macro docutils literal"><span class="pre">TRUE</span></tt>. It should return
<tt class="docutils literal"><span class="pre">ResUNIMPL</span></tt> if the instruction cannot be single-stepped. It should
return <tt class="docutils literal"><span class="pre">ResOK</span></tt> if the instruction is single-stepped.</p>
<p>The mutator context will be updated by the emulation/execution of the
instruction such that resuming the mutator will not cause the
instruction which was causing the fault to be executed.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">15. The protection module</a><ul>
<li><a class="reference internal" href="#introduction">15.1. Introduction</a></li>
<li><a class="reference internal" href="#interface">15.2. Interface</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="poolmvff.html"
                        title="previous chapter">14. Manually-Managed Variable-Size First-Fit Pool</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="protocol.html"
                        title="next chapter">16. Protocol inheritance</a></p><h4>Downloads</h4>

<p class="topless">
<a href="http://www.ravenbrook.com/project/mps/release/1.111.0/">MPS Kit release 1.111.0</a><br>
<a href="http://www.ravenbrook.com/project/mps/release/">All MPS Kit releases</a>
</p>

<h4>Issues</h4>

<p class="topless">
<a href="http://www.ravenbrook.com/project/mps/issue/?action=list&amp;view=status%3dopen&amp;display=Job:Priority:Title&amp;sort=Priority">Known issues</a><br>
<a href="http://www.ravenbrook.com/project/mps/issue/?action=fixed&release_fixed=1.111.0">Issues fixed in release 1.111.0</a>
</p><h4>Contact us</h4>

<p class="topless"><a href="mailto:mps-questions@ravenbrook.com">mps-questions@ravenbrook.com</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="protocol.html" title="16. Protocol inheritance"
             >next</a> |</li>
        <li class="right" >
          <a href="poolmvff.html" title="14. Manually-Managed Variable-Size First-Fit Pool"
             >previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="old.html" >Old design</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2013, Ravenbrook Limited.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>