

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7. C Style – formatting &mdash; Memory Pool System 1.111.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/mps.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.111.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Memory Pool System 1.111.0 documentation" href="../index.html" />
    <link rel="up" title="Design" href="index.html" />
    <link rel="next" title="8. Keyword arguments in the MPS" href="keyword-arguments.html" />
    <link rel="prev" title="6. Transliterating the alphabet into hexadecimal" href="guide.hex.trans.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="keyword-arguments.html" title="8. Keyword arguments in the MPS"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="guide.hex.trans.html" title="6. Transliterating the alphabet into hexadecimal"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Design</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="c-style-formatting">
<span id="design-guide-impl-c-format"></span><span id="index-0"></span><h1>7. C Style &#8211; formatting<a class="headerlink" href="#c-style-formatting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="guide.impl.c.format"></span><h2>7.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><span class="target" id="guide.impl.c.format.scope"></span><a class="mpstag reference internal" href="#guide.impl.c.format.scope">.scope:</a> This document describes the Ravenbrook conventions for the
general format of C source code in the MPS.</p>
<p><span class="target" id="guide.impl.c.format.readership"></span><a class="mpstag reference internal" href="#guide.impl.c.format.readership">.readership:</a> This document is intended for anyone working on or with the
C source code.</p>
</div>
<div class="section" id="general-formatting-conventions">
<h2>7.2. General Formatting Conventions<a class="headerlink" href="#general-formatting-conventions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="line-width">
<h3>7.2.1. Line Width<a class="headerlink" href="#line-width" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.width"></span><a class="mpstag reference internal" href="#guide.impl.c.format.width">.width:</a> Lines should be no wider than 72 characters. <span class="target" id="guide.impl.c.format.width.why"></span><a class="mpstag reference internal" href="#guide.impl.c.format.width.why">.width.why:</a> Many
people use 80 column terminal windows so that multiple windows can be
placed side by side. Restricting lines to 72 characters allows line
numbering to be used (in vi for example) and also allows diffs to be
displayed without overflowing the terminal.</p>
</div>
<div class="section" id="white-space">
<h3>7.2.2. White Space<a class="headerlink" href="#white-space" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.space.notab"></span><a class="mpstag reference internal" href="#guide.impl.c.format.space.notab">.space.notab:</a> No tab characters should appear in the source files.
Ordinary spaces should be used to indent and format the sources.
<span class="target" id="guide.impl.c.format.space.notab.why"></span><a class="mpstag reference internal" href="#guide.impl.c.format.space.notab.why">.space.notab.why:</a> Tab characters are displayed differently on different
platforms, and sometimes translated back and forth, destroying layout
information.</p>
<p><span class="target" id="guide.impl.c.format.space.punct"></span><a class="mpstag reference internal" href="#guide.impl.c.format.space.punct">.space.punct:</a> There should always be whitespace after commas and
semicolons and similar punctuation.</p>
<p><span class="target" id="guide.impl.c.format.space.op"></span><a class="mpstag reference internal" href="#guide.impl.c.format.space.op">.space.op:</a> Put white space around operators in expressions, except when
removing it would make the expression clearer by binding certain
sub-expressions more tightly. For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">foo</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">;</span>
</pre></div>
</div>
<p><span class="target" id="guide.impl.c.format.space.control"></span><a class="mpstag reference internal" href="#guide.impl.c.format.space.control">.space.control:</a> One space between the keyword, <tt class="docutils literal"><span class="pre">switch</span></tt>, <tt class="docutils literal"><span class="pre">while</span></tt>,
<tt class="docutils literal"><span class="pre">for</span></tt> and the following paren.  <span class="target" id="guide.impl.c.format.space.control.why"></span><a class="mpstag reference internal" href="#guide.impl.c.format.space.control.why">.space.control.why:</a> This distinguishes
control statements lexically from function calls, making it easier to
distinguish them visually and when searching with tools like grep.</p>
<p><span class="target" id="guide.impl.c.format.space.function.not"></span><a class="mpstag reference internal" href="#guide.impl.c.format.space.function.not">.space.function.not:</a> No space between a function name and the following
paren beginning its argument list.</p>
</div>
<div class="section" id="sections-and-paragraphs">
<h3>7.2.3. Sections and Paragraphs<a class="headerlink" href="#sections-and-paragraphs" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.section"></span><a class="mpstag reference internal" href="#guide.impl.c.format.section">.section:</a> Source files can be thought of as breaking down into
&#8220;sections&#8221; and &#8220;paragraphs&#8221;. A section might be the leader comment of a
file, the imports, or a set of declarations which are related.</p>
<p><span class="target" id="guide.impl.c.format.section.space"></span><a class="mpstag reference internal" href="#guide.impl.c.format.section.space">.section.space:</a> Precede sections by two blank lines (except the first
one in the file, which should be the leader comment in any case).</p>
<p><span class="target" id="guide.impl.c.format.section.comment"></span><a class="mpstag reference internal" href="#guide.impl.c.format.section.comment">.section.comment:</a> Each section should start with a banner comment (see
.comment.banner) describing what the section contains.</p>
<p><span class="target" id="guide.impl.c.format.para"></span><a class="mpstag reference internal" href="#guide.impl.c.format.para">.para:</a> Within sections, code often breaks down into natural units called
&#8220;paragraphs&#8221;. A paragraph might be a set of strongly related
declarations (Init and Finish, for example), or a few lines of code
which it makes sense to consider together (the assignment of fields into
a structure, for example).</p>
<p><span class="target" id="guide.impl.c.format.para.space"></span><a class="mpstag reference internal" href="#guide.impl.c.format.para.space">.para.space:</a> Precede paragraphs by a single blank line.</p>
</div>
<div class="section" id="statements">
<h3>7.2.4. Statements<a class="headerlink" href="#statements" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.statement.one"></span><a class="mpstag reference internal" href="#guide.impl.c.format.statement.one">.statement.one:</a> Generally only have at most one statement per line. In
particular the following are deprecated:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

<span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="k">case</span> <span class="mi">0</span>: <span class="n">f</span> <span class="o">=</span> <span class="n">inRampMode</span> <span class="o">?</span> <span class="n">AMCGen0RampmodeFrequency</span> <span class="o">:</span> <span class="n">AMCGen0Frequency</span><span class="p">;</span>
</pre></div>
</div>
<p><span class="target" id="guide.impl.c.format.statement.one.why"></span><a class="mpstag reference internal" href="#guide.impl.c.format.statement.one.why">.statement.one.why:</a> Debuggers can often only place breakpoints on lines,
not expressions or statements within a line. The <tt class="docutils literal"><span class="pre">if</span> <span class="pre">(thing)</span> <span class="pre">return;</span></tt> is
a particularly important case, if thing is a reasonably rare return
condition then you might want to breakpoint it in a debugger session.
Annoying because <tt class="docutils literal"><span class="pre">if</span> <span class="pre">(thing)</span> <span class="pre">return;</span></tt> is quite compact and pleasing
otherwise.</p>
</div>
<div class="section" id="indentation">
<h3>7.2.5. Indentation<a class="headerlink" href="#indentation" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.indent"></span><a class="mpstag reference internal" href="#guide.impl.c.format.indent">.indent:</a> Indent the body of a block by two spaces. For formatting
purposes, the &#8220;body of a block&#8221; means:</p>
<ul class="simple">
<li>statements between braces,</li>
<li>a single statement following a lone <tt class="docutils literal"><span class="pre">if</span></tt>;</li>
<li>statements in a switch body; see .switch.</li>
</ul>
<p>(<span class="target" id="guide.impl.c.format.indent.logical"></span><a class="mpstag reference internal" href="#guide.impl.c.format.indent.logical">.indent.logical:</a> The aim is to group what we think of as logical
blocks, even though they may not exactly match how &#8220;block&#8221; is used in
the definition of C syntax).</p>
<p>Some examples:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">ResOK</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SegFinish</span><span class="p">(</span><span class="o">&amp;</span><span class="n">span</span><span class="o">-&gt;</span><span class="n">segStruct</span><span class="p">);</span>
  <span class="n">PoolFreeP</span><span class="p">(</span><span class="n">MV</span><span class="o">-&gt;</span><span class="n">spanPool</span><span class="p">,</span> <span class="n">span</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SpanStruct</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">ResOK</span><span class="p">)</span>
  <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">block</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">step</span> <span class="o">==</span> <span class="n">block</span><span class="o">-&gt;</span><span class="n">limit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="o">-&gt;</span><span class="n">thing</span><span class="p">)</span>
      <span class="n">putc</span><span class="p">(</span><span class="sc">&#39;@&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">step</span> <span class="o">==</span> <span class="n">block</span><span class="o">-&gt;</span><span class="n">limit</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">putc</span><span class="p">(</span><span class="sc">&#39;]&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
  <span class="n">pop_bracket</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">putc</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="sc">&#39;A&#39;</span>:
  <span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span>
  <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="target" id="guide.impl.c.format.indent.goto-label"></span><a class="mpstag reference internal" href="#guide.impl.c.format.indent.goto-label">.indent.goto-label:</a> Place each goto-label on a line of its own,
outdented to the same level as the surrounding block. Then indent the
non-label part of the statement normally.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">result</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">statement</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">goto</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">statement</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">OK</span><span class="p">;</span>

<span class="nl">foo:</span>
  <span class="n">unwind</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">ERROR</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="target" id="guide.impl.c.format.indent.case-label"></span><a class="mpstag reference internal" href="#guide.impl.c.format.indent.case-label">.indent.case-label:</a> Outdent case- and default-labels in a switch
statement in the same way as <a class="reference internal" href="#guide.impl.c.format.indent.goto-label">.indent.goto-label</a>.  See <a class="reference internal" href="#guide.impl.c.format.switch">.switch</a>.</p>
<p><span class="target" id="guide.impl.c.format.indent.cont"></span><a class="mpstag reference internal" href="#guide.impl.c.format.indent.cont">.indent.cont:</a> If an expression or statement won&#8217;t fit on a single line,
indent the continuation lines by two spaces, apart from the following
exception:</p>
<p><span class="target" id="guide.impl.c.format.indent.cont.parens"></span><a class="mpstag reference internal" href="#guide.impl.c.format.indent.cont.parens">.indent.cont.parens:</a> if you break a statement inside a parameter list or
other parenthesized expression, indent so that the continuation lines up
just after the open parenthesis. For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">PoolClassInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PoolClassMVStruct</span><span class="p">,</span>
              <span class="s">&quot;MV&quot;</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">allocP</span><span class="p">,</span> <span class="n">freeP</span><span class="p">,</span>
              <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">describe</span><span class="p">,</span> <span class="n">isValid</span><span class="p">);</span>
</pre></div>
</div>
<p><span class="target" id="guide.impl.c.format.indent.cont.expr"></span><a class="mpstag reference internal" href="#guide.impl.c.format.indent.cont.expr">.indent.cont.expr:</a> Note that when breaking an expression it is clearer
to place the operator at the start of the continuation line:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">CHECKL</span><span class="p">(</span><span class="n">AddrAdd</span><span class="p">((</span><span class="n">Addr</span><span class="p">)</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">pageTableMapped</span><span class="p">,</span>
               <span class="n">BTSize</span><span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">pageTablePages</span><span class="p">))</span>
       <span class="o">&lt;=</span> <span class="n">AddrAdd</span><span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">,</span> <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">ullageSize</span><span class="p">));</span>
</pre></div>
</div>
<p>This is particularly useful in long conditional expressions that use &amp;&amp;
and ||. For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">trace</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">!=</span> <span class="n">TraceFINISHED</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">trace</span><span class="o">-&gt;</span><span class="n">emergency</span> <span class="o">||</span> <span class="n">traceWorkClock</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pollEnd</span><span class="p">));</span>
</pre></div>
</div>
<p><span class="target" id="guide.impl.c.format.indent.hint"></span><a class="mpstag reference internal" href="#guide.impl.c.format.indent.hint">.indent.hint:</a> Usually, it is possible to determine the correct
indentation for a line by looking to see if the previous line ends with
a semicolon. If it does, indent to the same amount, otherwise indent by
two more spaces. The main exceptions are lines starting with a close
brace, goto-labels, and line-breaks between parentheses.</p>
</div>
<div class="section" id="positioning-of-braces">
<h3>7.2.6. Positioning of Braces<a class="headerlink" href="#positioning-of-braces" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.brace.otb"></span><a class="mpstag reference internal" href="#guide.impl.c.format.brace.otb">.brace.otb:</a> Use the &#8220;One True Brace&#8221; (or OTB) style. This places the
open brace after the control word or expression, separated by a space,
and when there is an else, places that after the close brace. For
example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">isBase</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">new</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">=</span> <span class="n">limit</span><span class="p">;</span>
  <span class="n">new</span><span class="o">-&gt;</span><span class="n">limit</span> <span class="o">=</span> <span class="n">block</span><span class="o">-&gt;</span><span class="n">limit</span><span class="p">;</span>
  <span class="n">block</span><span class="o">-&gt;</span><span class="n">limit</span> <span class="o">=</span> <span class="n">base</span><span class="p">;</span>
  <span class="n">new</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">block</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
  <span class="n">block</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">new</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">new</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">=</span> <span class="n">block</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">;</span>
  <span class="n">new</span><span class="o">-&gt;</span><span class="n">limit</span> <span class="o">=</span> <span class="n">base</span><span class="p">;</span>
  <span class="n">block</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">=</span> <span class="n">limit</span><span class="p">;</span>
  <span class="n">new</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">block</span><span class="p">;</span>
  <span class="o">*</span><span class="n">prev</span> <span class="o">=</span> <span class="n">new</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The same applies to struct, enum, union.</p>
<p><span class="target" id="guide.impl.c.format.brace.otb.function.not"></span><a class="mpstag reference internal" href="#guide.impl.c.format.brace.otb.function.not">.brace.otb.function.not:</a> OTB is never used for function definitions.</p>
<p><span class="target" id="guide.impl.c.format.brace.always"></span><a class="mpstag reference internal" href="#guide.impl.c.format.brace.always">.brace.always:</a> Braces are always required after <tt class="docutils literal"><span class="pre">if</span></tt>, <tt class="docutils literal"><span class="pre">else</span></tt>, <tt class="docutils literal"><span class="pre">switch</span></tt>,
<tt class="docutils literal"><span class="pre">while</span></tt>, <tt class="docutils literal"><span class="pre">do</span></tt>, and <tt class="docutils literal"><span class="pre">for</span></tt>.</p>
<p><span class="target" id="guide.impl.c.format.brace.always.except"></span><a class="mpstag reference internal" href="#guide.impl.c.format.brace.always.except">.brace.always.except:</a> Except that a lone <tt class="docutils literal"><span class="pre">if</span></tt> with no <tt class="docutils literal"><span class="pre">else</span></tt> is allowed
to drop its braces when its body is a single simple statement. Typically
this will be a <tt class="docutils literal"><span class="pre">goto</span></tt> or an assignment. For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">ResOK</span><span class="p">)</span>
  <span class="k">goto</span> <span class="n">failStart</span><span class="p">;</span>
</pre></div>
</div>
<p>Note in particular that an <tt class="docutils literal"><span class="pre">if</span></tt> with an <tt class="docutils literal"><span class="pre">else</span></tt> must have braces on both
paths.</p>
</div>
<div class="section" id="switch-statements">
<h3>7.2.7. Switch Statements<a class="headerlink" href="#switch-statements" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.switch"></span><a class="mpstag reference internal" href="#guide.impl.c.format.switch">.switch:</a> format switch statements like this:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">switch</span> <span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="n">WIBBLE</span>:
<span class="k">case</span> <span class="n">WOBBLE</span>:
  <span class="p">{</span>
    <span class="kt">int</span> <span class="n">angle</span><span class="p">;</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">move</span><span class="p">(</span><span class="n">plate</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">angle</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="n">QUIET</span>:
  <span class="n">drop</span><span class="p">();</span>
  <span class="cm">/* fall-through */</span>

<span class="k">case</span> <span class="n">QUIESCENT</span>:
  <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">break</span><span class="p">;</span>

<span class="nl">default:</span>
  <span class="n">NOTREACHED</span><span class="p">;</span>
  <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The component rules that result in this style are:</p>
<p><span class="target" id="guide.impl.c.format.switch.break"></span><a class="mpstag reference internal" href="#guide.impl.c.format.switch.break">.switch.break:</a> The last line of every case-clause body must be an
unconditional jump statement (usually <tt class="docutils literal"><span class="pre">break</span></tt>, but may be <tt class="docutils literal"><span class="pre">goto</span></tt>,
<tt class="docutils literal"><span class="pre">continue</span></tt>, or <tt class="docutils literal"><span class="pre">return</span></tt>), or if a fall-through is intended, the comment
<tt class="docutils literal"><span class="pre">/*</span> <span class="pre">fall-through</span> <span class="pre">*/</span></tt>. (Note: if the unconditional jump should never be
taken, because of previous conditional jumps, use <tt class="xref c c-macro docutils literal"><span class="pre">NOTREACHED</span></tt> on the
line before it). This rule is to prevent accidental fall-throughs, even
if someone makes a editing mistake that causes a conditional jump to be
missed.</p>
<p><span class="target" id="guide.impl.c.format.switch.default"></span><a class="mpstag reference internal" href="#guide.impl.c.format.switch.default">.switch.default:</a> It is usually a good idea to have a default-clause,
even if all it contains is <tt class="xref c c-macro docutils literal"><span class="pre">NOTREACHED</span></tt> and <tt class="docutils literal"><span class="pre">break</span></tt>.  Remember that
<tt class="xref c c-macro docutils literal"><span class="pre">NOTREACHED</span></tt> doesn&#8217;t stop the process in all build varieties.</p>
</div>
<div class="section" id="formatting-comments">
<h3>7.2.8. Formatting Comments<a class="headerlink" href="#formatting-comments" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.comment"></span><a class="mpstag reference internal" href="#guide.impl.c.format.comment">.comment:</a> There are three types of comments: banners, paragraph
comments, and columnar comments.</p>
<p><span class="target" id="guide.impl.c.format.comment.banner"></span><a class="mpstag reference internal" href="#guide.impl.c.format.comment.banner">.comment.banner:</a> Banner comments come at the start of sections. A banner
comment consists of a heading usually composed of a symbol, an em-dash
(&#8211;) and an short explanation, followed by English text which is
formatted using conventional text documentation guidelines (see
guide.text). The open and close comment tokens (<tt class="docutils literal"><span class="pre">/*</span></tt> and <tt class="docutils literal"><span class="pre">*/</span></tt>) are
placed at the top and bottom of a column of asterisks. The text is
separated from the asterisks by one space. Place a blank line between
the banner comment and the section it comments. For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cm">/* BlockStruct --  Block descriptor</span>
<span class="cm"> *</span>
<span class="cm"> * The pool maintains a descriptor structure for each</span>
<span class="cm"> * contiguous allocated block of memory it manages.</span>
<span class="cm"> * The descriptor is on a simple linked-list of such</span>
<span class="cm"> * descriptors, which is in ascending order of address.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">BlockStruct</span> <span class="p">{</span>
</pre></div>
</div>
<p><span class="target" id="guide.impl.c.format.comment.para"></span><a class="mpstag reference internal" href="#guide.impl.c.format.comment.para">.comment.para:</a> Paragraph comments come at the start of paragraphs in the
code. A paragraph comment consists of formatted English text, with each
line wrapped by the open and close comment tokens (<tt class="docutils literal"><span class="pre">/*</span></tt> and <tt class="docutils literal"><span class="pre">*/</span></tt>).
(This avoids problems when cutting and pasting comments.) For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cm">/* If the freed area is in the base sentinel then insert */</span>
<span class="cm">/* the new descriptor after it, otherwise insert before. */</span>
<span class="k">if</span><span class="p">(</span><span class="n">isBase</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
<p><span class="target" id="guide.impl.c.format.comment.para.precede"></span><a class="mpstag reference internal" href="#guide.impl.c.format.comment.para.precede">.comment.para.precede:</a> Paragraph comments, even one-liners, precede the
code to which they apply.</p>
<p><span class="target" id="guide.impl.c.format.comment.column"></span><a class="mpstag reference internal" href="#guide.impl.c.format.comment.column">.comment.column:</a> Columnar comments appear in a column to the right of
the code. They should be used sparingly, since they clutter the code and
make it hard to edit. Use them on variable declarations and structure,
union, or enum declarations. They should start at least at column 32
(counting from 0, that is, on a tab-stop), and should be terse
descriptive text. Abandon English sentence structure if this makes the
comment clearer. Don&#8217;t write more than one line. Here&#8217;s an example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">PoolMVStruct</span> <span class="p">{</span>
  <span class="n">Pool</span> <span class="n">blockPool</span><span class="p">;</span>           <span class="cm">/* for block descriptors */</span>
  <span class="n">Pool</span> <span class="n">spanPool</span><span class="p">;</span>            <span class="cm">/* for span descriptors */</span>
  <span class="kt">size_t</span> <span class="n">extendBy</span><span class="p">;</span>          <span class="cm">/* size to extend pool by */</span>
  <span class="kt">size_t</span> <span class="n">avgSize</span><span class="p">;</span>           <span class="cm">/* estimate of allocation size */</span>
  <span class="kt">size_t</span> <span class="n">maxSize</span><span class="p">;</span>           <span class="cm">/* estimate of maximum size */</span>
  <span class="n">Addr</span> <span class="n">space</span><span class="p">;</span>               <span class="cm">/* total free space in pool */</span>
  <span class="n">Addr</span> <span class="n">lost</span><span class="p">;</span>                <span class="cm">/* lost when free can&#39;t allocate */</span>
  <span class="k">struct</span> <span class="n">SpanStruct</span> <span class="o">*</span><span class="n">spans</span><span class="p">;</span> <span class="cm">/* span chain */</span>
<span class="p">}</span> <span class="n">PoolMVStruct</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="macros">
<h3>7.2.9. Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="guide.impl.c.format.macro.careful"></span><a class="mpstag reference internal" href="#guide.impl.c.format.macro.careful">.macro.careful:</a> Macros in C are a real horror bag, be extra careful.
There&#8217;s lots that could go here, but proper coverage probably deserves a
separate document. Which isn&#8217;t written yet.</p>
<p><span class="target" id="guide.impl.c.format.macro.general"></span><a class="mpstag reference internal" href="#guide.impl.c.format.macro.general">.macro.general:</a> Do try and follow the other formatting conventions for
code in macro definitions.</p>
<p><span class="target" id="guide.impl.c.format.macro.backslash"></span><a class="mpstag reference internal" href="#guide.impl.c.format.macro.backslash">.macro.backslash:</a> Backslashes used for continuation lines in macro
definitions should be put on the right somewhere where they will be less
in the way. Example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#define RAMP_RELATION(X)                       \</span>
<span class="cp">  X(RampOUTSIDE,        &quot;outside ramp&quot;)        \</span>
<span class="cp">  X(RampBEGIN,          &quot;begin ramp&quot;)          \</span>
<span class="cp">  X(RampRAMPING,        &quot;ramping&quot;)             \</span>
<span class="cp">  X(RampFINISH,         &quot;finish ramp&quot;)         \</span>
<span class="cp">  X(RampCOLLECTING,     &quot;collecting ramp&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="history">
<h2>7.3. History<a class="headerlink" href="#history" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>2007-06-04  <a class="reference external" href="http://www.ravenbrook.com/consultants/drj">DRJ</a>  Adopted from Harlequin MMinfo version and edited.</li>
<li>2007-06-04  <a class="reference external" href="http://www.ravenbrook.com/consultants/drj">DRJ</a>  Changed .width from 80 to 72. Banned space between
<tt class="docutils literal"><span class="pre">if</span></tt> and <tt class="docutils literal"><span class="pre">(</span></tt>. Required braces on almost everything. Clarified that
paragraph comments precede the code.</li>
<li>2007-06-13  <a class="reference external" href="http://www.ravenbrook.com/consultants/rhsk">RHSK</a>  Removed .brace.block, because MPS source always
uses .brace.otb. Remove .indent.elseif because it is obvious (ahem) and
showing an example is sufficient. New rules for .switch.*: current MPS
practice is a mess, so lay down a neat new law.</li>
<li>2007-06-27  <a class="reference external" href="http://www.ravenbrook.com/consultants/rhsk">RHSK</a>  Added <a class="reference internal" href="#guide.impl.c.format.space.function.not">.space.function.not</a>.</li>
<li>2007-07-17  <a class="reference external" href="http://www.ravenbrook.com/consultants/drj">DRJ</a>  Added .macro.*</li>
<li>2012-09-26  <a class="reference external" href="http://www.ravenbrook.com/consultants/rb">RB</a>  Converted to Markdown and reversed inconsistent
switch &#8220;law&#8221;.</li>
</ul>
</div>
<div class="section" id="copyright-and-license">
<h2>7.4. Copyright and License<a class="headerlink" href="#copyright-and-license" title="Permalink to this headline">¶</a></h2>
<p>This document is copyright © 2002-2012 [Ravenbrook
Limited](<a class="reference external" href="http://www.ravenbrook.com/">http://www.ravenbrook.com/</a>). All rights reserved. This is an
open source license. Contact Ravenbrook for commercial licensing
options.</p>
<p>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:</p>
<ol class="arabic simple">
<li>Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright
notice, this list of conditions and the following disclaimer in the
documentation and/or other materials provided with the distribution.</li>
<li>Redistributions in any form must be accompanied by information on
how to obtain complete source code for this software and any
accompanying software that uses this software. The source code must
either be included in the distribution or be available for no more
than the cost of distribution plus a nominal fee, and must be freely
redistributable under reasonable conditions. For an executable file,
complete source code means the source code for all modules it
contains. It does not include source code for modules or files that
typically accompany the major components of the operating system on
which the executable file runs.</li>
</ol>
<p><strong>This software is provided by the copyright holders and contributors
&#8220;as is&#8221; and any express or implied warranties, including, but not
limited to, the implied warranties of merchantability, fitness for a
particular purpose, or non-infringement, are disclaimed. In no event
shall the copyright holders and contributors be liable for any direct,
indirect, incidental, special, exemplary, or consequential damages
(including, but not limited to, procurement of substitute goods or
services; loss of use, data, or profits; or business interruption)
however caused and on any theory of liability, whether in contract,
strict liability, or tort (including negligence or otherwise) arising in
any way out of the use of this software, even if advised of the
possibility of such damage.</strong></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7. C Style &#8211; formatting</a><ul>
<li><a class="reference internal" href="#introduction">7.1. Introduction</a></li>
<li><a class="reference internal" href="#general-formatting-conventions">7.2. General Formatting Conventions</a><ul>
<li><a class="reference internal" href="#line-width">7.2.1. Line Width</a></li>
<li><a class="reference internal" href="#white-space">7.2.2. White Space</a></li>
<li><a class="reference internal" href="#sections-and-paragraphs">7.2.3. Sections and Paragraphs</a></li>
<li><a class="reference internal" href="#statements">7.2.4. Statements</a></li>
<li><a class="reference internal" href="#indentation">7.2.5. Indentation</a></li>
<li><a class="reference internal" href="#positioning-of-braces">7.2.6. Positioning of Braces</a></li>
<li><a class="reference internal" href="#switch-statements">7.2.7. Switch Statements</a></li>
<li><a class="reference internal" href="#formatting-comments">7.2.8. Formatting Comments</a></li>
<li><a class="reference internal" href="#macros">7.2.9. Macros</a></li>
</ul>
</li>
<li><a class="reference internal" href="#history">7.3. History</a></li>
<li><a class="reference internal" href="#copyright-and-license">7.4. Copyright and License</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="guide.hex.trans.html"
                        title="previous chapter">6. Transliterating the alphabet into hexadecimal</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="keyword-arguments.html"
                        title="next chapter">8. Keyword arguments in the MPS</a></p><h4>Downloads</h4>

<p class="topless">
<a href="http://www.ravenbrook.com/project/mps/release/1.111.0/">MPS Kit release 1.111.0</a><br>
<a href="http://www.ravenbrook.com/project/mps/release/">All MPS Kit releases</a>
</p>

<h4>Issues</h4>

<p class="topless">
<a href="http://www.ravenbrook.com/project/mps/issue/?action=list&amp;view=status%3dopen&amp;display=Job:Priority:Title&amp;sort=Priority">Known issues</a><br>
<a href="http://www.ravenbrook.com/project/mps/issue/?action=fixed&release_fixed=1.111.0">Issues fixed in release 1.111.0</a>
</p><h4>Contact us</h4>

<p class="topless"><a href="mailto:mps-questions@ravenbrook.com">mps-questions@ravenbrook.com</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="keyword-arguments.html" title="8. Keyword arguments in the MPS"
             >next</a> |</li>
        <li class="right" >
          <a href="guide.hex.trans.html" title="6. Transliterating the alphabet into hexadecimal"
             >previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Design</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2013, Ravenbrook Limited.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>