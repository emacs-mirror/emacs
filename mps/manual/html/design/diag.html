

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>9. Diagnostic feedback &mdash; Memory Pool System 1.111.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/mps.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.111.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Memory Pool System 1.111.0 documentation" href="../index.html" />
    <link rel="up" title="Old design" href="old.html" />
    <link rel="next" title="10. Finalization" href="finalize.html" />
    <link rel="prev" title="8. Collection framework" href="collection.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="finalize.html" title="10. Finalization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="collection.html" title="8. Collection framework"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="old.html" accesskey="U">Old design</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="diagnostic-feedback">
<span id="design-diag"></span><span id="index-0"></span><h1>9. Diagnostic feedback<a class="headerlink" href="#diagnostic-feedback" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="design.mps.diag"></span><h2>9.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><span class="target" id="design.mps.diag.intro"></span><a class="mpstag reference internal" href="#design.mps.diag.intro">.intro:</a> This document describes how to use the diagnostic feedback
mechanism in the Memory Pool System.</p>
<p><span class="target" id="design.mps.diag.sources"></span><a class="mpstag reference internal" href="#design.mps.diag.sources">.sources:</a> Initially abased on <a class="reference internal" href="#rhsk-2007-04-13">[RHSK_2007-04-13]</a> and <a class="reference internal" href="#rhsk-2007-04-18">[RHSK_2007-04-18]</a>.</p>
</div>
<div class="section" id="overview">
<h2>9.2. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Diagnostic feedback is information created by the MPS diagnostic
system for the purpose of helping MPS programmers and client
programmers.</p>
<p>Such a piece of information is called &#8220;a diagnostic&#8221;. (See also
<a class="reference internal" href="#design.mps.diag.parts">.parts</a>.)</p>
<p>A diagnostic is not intended to be visible to end users, or readable
by them.</p>
<p>A diagnostic is not intended to be stable from one release to the
next: it may be modified or removed at any time.</p>
</div>
<div class="section" id="requirements">
<h2>9.3. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>MPS diagnostic feedback code must do these things:</p>
<ul class="simple">
<li>calculate, store, and propagate data;</li>
<li>collate, synthesise, and format it into a human-useful diagnostic;</li>
<li>control (for example, filter) output of diagnostics;</li>
<li>use a channel to get the diagnostic out.</li>
</ul>
</div>
<div class="section" id="usage">
<h2>9.4. Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>To get diagnostic output from the MPS, you must use a variety with
diagnostics compiled-in. Currently, that means variety.cool. See
<tt class="docutils literal"><span class="pre">config.h</span></tt>.</p>
<p>There are two mechanism for getting diagnostic output:</p>
<ol class="arabic">
<li><p class="first">Automatically via the telemetry system. See design.mps.telemetry,
and the &#8220;Telemetry&#8221; chapter in the manual.</p>
</li>
<li><p class="first">Manually via the debugger. In the debugger, set break points at the
places where you want to inspect data structures (or wait for the
debugger to be entered via an <tt class="xref c c-func docutils literal"><span class="pre">abort()</span></tt> call or unhandled
segmentation fault). Then at the debugger command prompt, run
<tt class="xref c c-func docutils literal"><span class="pre">Describe()</span></tt> commands of your choice. For example:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">run</span>
<span class="n">Starting</span> <span class="n">program</span><span class="o">:</span> <span class="n">mv2test</span>
<span class="n">Reading</span> <span class="n">symbols</span> <span class="k">for</span> <span class="n">shared</span> <span class="n">libraries</span> <span class="o">+</span><span class="p">.............................</span> <span class="n">done</span>
<span class="n">cbs</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">94</span><span class="o">:</span> <span class="n">MPS</span> <span class="n">ASSERTION</span> <span class="n">FAILED</span><span class="o">:</span> <span class="o">!</span><span class="n">cbs</span><span class="o">-&gt;</span><span class="n">inCBS</span>

<span class="n">Program</span> <span class="n">received</span> <span class="n">signal</span> <span class="n">SIGABRT</span><span class="p">,</span> <span class="n">Aborted</span><span class="p">.</span>
<span class="mh">0x00007fff83e42d46</span> <span class="n">in</span> <span class="n">__kill</span> <span class="p">()</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">frame</span> <span class="mi">12</span>
<span class="cp">#12 0x000000010000b1fc in MVTFree (pool=0x103ffe160, base=0x101dfd000, size=5024) at poolmv2.c:711</span>
<span class="mi">711</span>         <span class="n">Res</span> <span class="n">res</span> <span class="o">=</span> <span class="n">CBSInsert</span><span class="p">(</span><span class="n">MVTCBS</span><span class="p">(</span><span class="n">mvt</span><span class="p">),</span> <span class="n">base</span><span class="p">,</span> <span class="n">limit</span><span class="p">);</span>
<span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">p</span> <span class="n">MVTDescribe</span><span class="p">(</span><span class="n">mvt</span><span class="p">,</span> <span class="n">mps_lib_get_stdout</span><span class="p">())</span>
<span class="n">MVT</span> <span class="mf">0000000103FF</span><span class="n">E160</span>
<span class="p">{</span>
  <span class="nl">minSize:</span> <span class="mi">8</span>
  <span class="nl">meanSize:</span> <span class="mi">42</span>
  <span class="nl">maxSize:</span> <span class="mi">8192</span>
  <span class="nl">fragLimit:</span> <span class="mi">30</span>
  <span class="nl">reuseSize:</span> <span class="mi">16384</span>
  <span class="nl">fillSize:</span> <span class="mi">8192</span>
  <span class="nl">availLimit:</span> <span class="mi">1110835</span>
  <span class="nl">abqOverflow:</span> <span class="n">FALSE</span>
  <span class="nl">splinter:</span> <span class="n">TRUE</span>
  <span class="nl">splinterSeg:</span> <span class="mf">0000000103F</span><span class="n">EE780</span>
  <span class="nl">splinterBase:</span> <span class="mo">0000000101</span><span class="n">D7ABB8</span>
  <span class="nl">splinterLimit:</span> <span class="mo">0000000101</span><span class="n">D7B000</span>
<span class="cp">  # ... etc ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="how-to-write-a-diagnostic">
<h2>9.5. How to write a diagnostic<a class="headerlink" href="#how-to-write-a-diagnostic" title="Permalink to this headline">¶</a></h2>
<div class="section" id="compile-away-in-non-diag-varieties-no-side-effects">
<h3>9.5.1. Compile away in non-diag varieties; no side effects<a class="headerlink" href="#compile-away-in-non-diag-varieties-no-side-effects" title="Permalink to this headline">¶</a></h3>
<p>Wrap code with the <tt class="xref c c-macro docutils literal"><span class="pre">STATISTIC</span></tt> and <tt class="xref c c-macro docutils literal"><span class="pre">METER</span></tt> macros, to make sure
that non-diagnostic varieties do not execute diagnostic-generating
code.</p>
<p>Diagnostic-generating code must have no side effects.</p>
</div>
<div class="section" id="writing-good-paragraph-text">
<h3>9.5.2. Writing good paragraph text<a class="headerlink" href="#writing-good-paragraph-text" title="Permalink to this headline">¶</a></h3>
<p>Make your diagnostics easy to understand! Other people will read your
diagnostics! Make them clear and helpful. Do not make them terse and
cryptic. If you use symbols, print a key in the diagnostic.</p>
</div>
</div>
<div class="section" id="how-the-mps-diagnostic-system-works">
<h2>9.6. How the MPS diagnostic system works<a class="headerlink" href="#how-the-mps-diagnostic-system-works" title="Permalink to this headline">¶</a></h2>
<div class="section" id="parts-of-the-mps-diagnostic-system">
<h3>9.6.1. Parts of the MPS diagnostic system<a class="headerlink" href="#parts-of-the-mps-diagnostic-system" title="Permalink to this headline">¶</a></h3>
<p><span class="target" id="design.mps.diag.parts"></span><a class="mpstag reference internal" href="#design.mps.diag.parts">.parts:</a> The following facilities are considered part of the MPS
diagnostic system:</p>
<ul class="simple">
<li>the <tt class="xref c c-func docutils literal"><span class="pre">Describe()</span></tt> methods.</li>
<li>the <tt class="xref c c-macro docutils literal"><span class="pre">STATISTIC</span></tt> macros (see <tt class="docutils literal"><span class="pre">mpm.h</span></tt>);</li>
<li>the <tt class="xref c c-macro docutils literal"><span class="pre">METER</span></tt> macros and meter subsystem.</li>
</ul>
</div>
<div class="section" id="related-systems">
<h3>9.6.2. Related systems<a class="headerlink" href="#related-systems" title="Permalink to this headline">¶</a></h3>
<p>The MPS diagnostic system is separate from the following other MPS
systems:</p>
<ul class="simple">
<li>The telemetry-log-events system. This emits much more data, in a
less human-readable form, requires MPS-aware external tools, and is
more stable from release to release). In non-diagnostic telemetry
varieties, the telemetry-log-events system emits events that log all
normal MPS actions. In diagnostic telemetry varieties, it may emit
additional events containing diagnostic information. Additionally,
the telemetry-log-events stream might in future be available as a
channel for emitting human-readable text diagnostics. See also
design.mps.telemetry.</li>
<li>The MPS message system. This is present in all varieties, and
manages asynchronous communication from the MPS to the client
program). However, the MPS message system might in future also be
available as a channel for emitting diagnostics. See also
design.mps.message.</li>
</ul>
</div>
</div>
<div class="section" id="references">
<h2>9.7. References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils citation" frame="void" id="rhsk-2007-04-13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[RHSK_2007-04-13]</a></td><td>Richard Kistruck. 2007-04-13. &#8220;<a class="reference external" href="https://info.ravenbrook.com/mail/2007/04/13/13-07-45/0.txt">diagnostic feedback from the MPS</a>&#8221;.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="rhsk-2007-04-18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[RHSK_2007-04-18]</a></td><td>Richard Kistruck. 2007-04-18. &#8220;<a class="reference external" href="http://info.ravenbrook.com/mail/2007/04/18/10-58-49/0.txt">Diverse types of diagnostic feedback</a>&#8221;.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">9. Diagnostic feedback</a><ul>
<li><a class="reference internal" href="#introduction">9.1. Introduction</a></li>
<li><a class="reference internal" href="#overview">9.2. Overview</a></li>
<li><a class="reference internal" href="#requirements">9.3. Requirements</a></li>
<li><a class="reference internal" href="#usage">9.4. Usage</a></li>
<li><a class="reference internal" href="#how-to-write-a-diagnostic">9.5. How to write a diagnostic</a><ul>
<li><a class="reference internal" href="#compile-away-in-non-diag-varieties-no-side-effects">9.5.1. Compile away in non-diag varieties; no side effects</a></li>
<li><a class="reference internal" href="#writing-good-paragraph-text">9.5.2. Writing good paragraph text</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-the-mps-diagnostic-system-works">9.6. How the MPS diagnostic system works</a><ul>
<li><a class="reference internal" href="#parts-of-the-mps-diagnostic-system">9.6.1. Parts of the MPS diagnostic system</a></li>
<li><a class="reference internal" href="#related-systems">9.6.2. Related systems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">9.7. References</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="collection.html"
                        title="previous chapter">8. Collection framework</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="finalize.html"
                        title="next chapter">10. Finalization</a></p><h4>Downloads</h4>

<p class="topless">
<a href="http://www.ravenbrook.com/project/mps/release/1.111.0/">MPS Kit release 1.111.0</a><br>
<a href="http://www.ravenbrook.com/project/mps/release/">All MPS Kit releases</a>
</p>

<h4>Issues</h4>

<p class="topless">
<a href="http://www.ravenbrook.com/project/mps/issue/?action=list&amp;view=status%3dopen&amp;display=Job:Priority:Title&amp;sort=Priority">Known issues</a><br>
<a href="http://www.ravenbrook.com/project/mps/issue/?action=fixed&release_fixed=1.111.0">Issues fixed in release 1.111.0</a>
</p><h4>Contact us</h4>

<p class="topless"><a href="mailto:mps-questions@ravenbrook.com">mps-questions@ravenbrook.com</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="finalize.html" title="10. Finalization"
             >next</a> |</li>
        <li class="right" >
          <a href="collection.html" title="8. Collection framework"
             >previous</a> |</li>
        <li><a href="../index.html">Memory Pool System 1.111.0 documentation</a> &raquo;</li>
          <li><a href="old.html" >Old design</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2013, Ravenbrook Limited.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>