        DESCRIPTION OF THE MPS C INTERFACE SYMBOL "MPS_FIX_CALL"
                       symbol.mps.c.MPS_FIX_CALL
                              draft symbol
                            pekka 1998-01-19

NAME

MPS_FIX_CALL


SUMMARY

MPS_FIX_CALL is used to call a scanning function from within MPS_SCAN_BEGIN and 
MPS_SCAN_END.


ASSOCIATED PROTOCOLS

Format.


SYNTAX

MPS_FIX_CALL(ss, call);


ARGUMENTS

mps_ss    the scan state argument that was passed to the scanning function
call      an expression (containing a call to a scanning function)


RETURNED VALUES

None.


RESOURCES

mps.h.


DESCRIPTION

When using the MPS_SCAN_BEGIN and MPS_SCAN_END macros, you can't directly call 
a separate function to do part of the scanning, because between MPS_SCAN_BEGIN 
and MPS_SCAN_END, the scan_state parameter is in a strange state, so you 
shouldn't pass it as an argument to a function.  However, if really want to do 
it (say, because you have an embedded structure shared between two scan 
methods), you can pass the scan state correctly using MPS_FIX_CALL.

Note that you must receive the return value of the scanning function called, 
and pass it on as described in the ERROR HANDLING section.


EXAMPLE

mps_res_t foo_scan(mps_ss_t scan_state, mps_addr_t base, mps_addr_t limit)
{
  Object *obj;
  Object *obj_limit;
  mps_res_t res;

  obj_limit = limit;
  MPS_SCAN_BEGIN(scan_state)
    for(obj = base; obj < obj_limit; obj++) {
      if(MPS_FIX(scan_state, &obj->left) != MPS_RES_OK)
        return res;
      MPS_FIX_CALL(scan_state,
                   res = scan_data(scan_state, &obj->data));
      if(res != MPS_RES_OK) return res;
      if(MPS_FIX(scan_state, &obj->right) != MPS_RES_OK)
        return res;
    }
  MPS_SCAN_END(scan_state);
  return MPS_RES_OK;
}


ERROR HANDLING

You must receive the return value of the function called.  Like all scanning 
functions, it returns "MPS_RES_OK" if it was successful, in which case the 
caller should continue to scan the rest of the object, fixing the remaining 
references.  If it returns a value other than "MPS_RES_OK", the calling 
scanning function must return that value, and may return without scanning 
further references.  Generally, it is better if it returns as soon as possible.


SEE ALSO

mps_fix, mps_ss_t, mps_root_scan_t, mps_fmt_scan_t, mps_reg_scan_t, 
MPS_SCAN_BEGIN, MPS_SCAN_END, MPS_FIX, MPS_FIX1, MPS_FIX2


INTERNAL NOTES

See mps_fix.


