          DESCRIPTION OF THE MPS C INTERFACE SYMBOL "MPS_FIX"
                          symbol.mps.c.mps_fix
                              draft symbol
                           gavinm 1997-05-02

NAME

mps_fix


SUMMARY

The function "mps_fix" is the part of the scanning protocol used to indicate 
references to the MPS.  It may only be called from within a scanning function.


ASSOCIATED PROTOCOLS

Format.


SYNTAX

mps_res_t mps_fix(mps_ss_t mps_ss, mps_addr_t *ref_io)


ARGUMENTS

mps_ss    the scan state argument that was passed to the scanning function
ref_io    a pointer to a reference within the object being scanned


RETURNED VALUES

Returns a result code, see ERROR HANDLING.

If the reference rank of the object being scanned is not "MPS_RANK_AMBIG" then 
the reference pointed to by "ref_io" may be modified by "mps_fix".


RESOURCES

mps.h


DESCRIPTION

This function is the part of the scanning protocol used to indicate 
references.  Scanning functions apply it or "MPS_FIX" to the references in the 
object being scanned.

It may only be called from within a scanning function.  If it is called within 
a"MPS_SCAN_BEGIN" block, "MPS_FIX_CALL" must be used.

This function does not perform any particular operation.  The MPS may call 
scanning functions for a number of reasons, and "mps_fix" may take different 
actions depending on those reasons.


EXAMPLE

mps_res_t scan_array(mps_ss_t ss, mps_addr_t object, size_t length)
{
  size_t i;
  mps_res_t res;
  mps_addr_t *array = (mps_addr_t *)object;

  for(i = 0; i < length; ++i) {
    res = mps_fix(ss, &array[i]);
    if(res != MPS_RES_OK) return res;
  }
  return res;
}


ERROR HANDLING

The function returns "MPS_RES_OK" if it was successful, in which case the 
scanning function should continue to scan the rest of the object, applying 
"mps_fix" to the remaining references.  If "mps_fix" returns a value other than 
"MPS_RES_OK", the scanning function must return that value, and may return 
without scanning further references.  Generally, it is better if it returns as 
soon as possible.


SEE ALSO

mps_ss_t, mps_root_scan_t, mps_fmt_scan_t, mps_reg_scan_t, MPS_SCAN_BEGIN, 
MPS_SCAN_END, MPS_FIX, MPS_FIX1, MPS_FIX2, MPS_FIX_CALL


INTERNAL NOTES

This doc needs to refer to discussion of scanning and updating of pointers 
somewhere -- richard 1997-05-06.

Tucker suggests (see mail.ptw.1997-05-02.22-35(0)) that we call this operation 
"keep" or "preserve", rather than "fix", in order to be more generic and more 
client-centred.

Richard has further comments on renaming this function (see 
mail.richard.1997-05-06.12-31).


