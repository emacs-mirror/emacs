                 HOW TO SET UP AUTOMATED MMQA TEST RUNS
                         guide.mmqa.automation
                             incomplete doc
                            tony 1999-10-06

SETTING UP AUTOMATED OVERNIGHT MMQA TEST RUNS


.nt: My only experience in automated runs of MMQA tests is on Windows NT, so 
that is what I've described here. I expect that setting up similar test runs on 
unix platforms would be relatively straightforward, by rewriting the batch 
files below in your favourite shell, and using cron instead of AT.

.resources: You'll need a PC running Windows NT, with MSVC, Perl 5 and Hope 
installed. If you want to run all relevant tests, I don't recommend doing it 
with less than 128MB of memory.

.directory: For the purposes of these instructions, I'll assume you've created 
a directory on drive D called daily-test.

.scripts: The actual testing is done by a couple of simple DOS batch files. 
First create D:\daily-test\daily-test.bat, containing the following line:

   D:\daily-test\daily-cmds.bat 2>&1 | tee.exe D:\daily-test\stdout.log

Then create D:\daily-test\daily-cmds.bat, containing the following:

  D:
  cd D:\daily-test
  rmdir /s /q src
  set HOPEUSER=rit
  call hope co MMsrc!(.) -missing-dir create

  cd src
  nmake /f w3i3mv.nmk "VARIETY=ci" mmdw.lib mpsplan.lib
  nmake /f w3i3mv.nmk "VARIETY=hi" mmdw.lib mpsplan.lib
  nmake /f w3i3mv.nmk "VARIETY=wi" mmdw.lib mpsplan.lib
  mv w3i3mv w3i3mv_mmdw
  nmake /f w3i3mv.nmk "VARIETY=ci" mmsw.lib mpsplan.lib
  nmake /f w3i3mv.nmk "VARIETY=wi" mmsw.lib mpsplan.lib
  mv w3i3mv w3i3mv_mmsw
  cd ..

  call hope co -recursive MMQA! -missing-dir create

  cd mmqa

  set "MMQA_MPS_INCLUDE_DIR=../src"
  set "MMQA_MPS_LINK_OBJ=../src/w3i3mv_mmdw/ci/mmdw.lib 
../src/w3i3mv_mmdw/ci/mpsplan.lib"
  set "MMQA_LOG_DIR=./log"
  set "MMQA_MAIL_SUBJECT=MMQA-daily-mmdw:"

  perl .\test\qa runset testsets\dailydw

  set "MMQA_MPS_LINK_OBJ=../src/w3i3mv_mmdw/hi/mmdw.lib 
../src/w3i3mv_mmdw/hi/mpsplan.lib"
  perl .\test\qa clib
  perl .\test\qa run function\124.c

  set "MMQA_MPS_LINK_OBJ=../src/w3i3mv_mmdw/wi/mmdw.lib 
../src/w3i3mv_mmdw/wi/mpsplan.lib"
  perl .\test\qa clib
  perl .\test\qa run function\124.c


  set "MMQA_MPS_INCLUDE_DIR=../src"
  set "MMQA_MPS_LINK_OBJ=../src/w3i3mv_mmsw/ci/mmsw.lib 
../src/w3i3mv_mmsw/ci/mpsplan.lib"
  set "MMQA_LOG_DIR=./log"
  set "MMQA_MAIL_SUBJECT=MMQA-daily-mmsw:"

  perl .\test\qa runset testsets\dailysw

  set "MMQA_MPS_LINK_OBJ=../src/w3i3mv_mmsw/wi/mmsw.lib 
../src/w3i3mv_mmsw/wi/mpsplan.lib"

  perl .\test\qa runset testsets\perfsw

  exit


.script.notes:

WAYS IN WHICH YOU MAY WANT TO MODIFY THESE SCRIPTS

You can modify daily-cmds.bat to run whatever tests you like, on whatever 
varieties and products of MPS. (See guide.mmqa for details of how to run MMQA 
tests.) The best way to modify what tests you run is not to change the scripts, 
however, but to change the testsets dailydw, dailysw and perfsw. These are in 
the hope compound MMQA_testsets.

You will probably want to change HOPEUSER to be someone other than "rit".

If you're trying to run tests on Terpsichore, you'll need to add the following 
line to the beginning of daily-cmds.bat:
  call C:\users\rit\bin\use5.0
This is a call to a script that sets up the environment variables to use 
MSVC5.0. Terpsichore has both versions 4.2 and 5.0 installed, and by default 
the variables may not be set correctly for either version.

The script daily-test.bat calls the program tee.exe, which should therefore be 
on your path. If you don't have it, it's included in the MMQA test harness 
(look in mmqa\test\script\ntx86bin\tee.exe), so you can copy it and install 
where necessary.


.at: To cause the testing to run automatically, use Windows NT's AT command. 
You'll need to type something like this:

  AT 20:00 /INTERACTIVE /EVERY:Monday,Tuesday,Wednesday,Thursday,Friday 
"D:\daily-test\daily-test.bat"

You can check the settings by typing just "AT", or "AT <id>" (if this is the 
only thing you've set up with AT, <id> will be 1). Annoying, I've been unable 
to get AT to accept abbreviation for the names of days.

.schedule: For the AT program to work, you must be running the "Schedule" 
service. If you aren't you'll get an error. To run this service, open the 
Services control panel, select "Task Scheduler" from the list, start it and 
make sure it is set to "automatic" startup.


POTENTIAL PROBLEMS

.problem.disc-space: Some MMQA test can produce a lot of output. During a run 
of a testset, it accumulates in one big file; therefore you may need quite a 
lot of free disc space (on the relevant drive) otherwise later tests will fail. 
200MB is doubtless more than enough. If you find you don't have enough, make 
more, or split up the testing into a number of smaller testsets or individual 
test runs.

.problem.interactive: I always leave my PC logged on (as me). When testing 
begins, it brings up a command window displaying the output -- this is very 
useful in case it goes wrong and the window is still there the next morning. I 
don't know what will happen if you try it when noone is logged on to the 
machine.

.problem.memory: Some of the tests use up all available memory for a short 
time. The test harness can cope with this, and will be fine, but if other 
programs are running they could find there is insufficient memory. You may 
therefore want to try to schedule tests to run at a different time from backups.

.problem.backup: I have seen occasional inexplicable failures of individual 
tests, which I can't replicate. I hypothesize that backup software may be 
reading files at the same time as the test system is trying to write them, 
which could cause problems. You may therefore want to try to schedule tests to 
run at a different time from backups.

rit 1999-08-31



