             NOTES FROM GENERAL DESIGN MEETING, 1997-02-20
                       meeting.general.1997-02-20
                               draft doc
                           richard 1997-02-21

INTRODUCTION

.intro: Richard Brooksby <richard> met Nick Barnes <nickb> to try to resolve 
the design of the optional argument passing convention.


NOTES

The following examples were developed for comparison between structure passing 
and keyargs.


With no optional arguments.  We could allow NULL to indicate that no options 
are specified.

  foo(spong, wibble, NULL);

  foo(spong, wibble, KEY_END);


With one argument.

  mps_foo_opt_s foo_opt_s = FOO_OPT_INIT;
  MPS_OPT1(foo_opt_s, foo, bar, qux);
  foo(spong, wibble, &foo_opt_s);

  foo(spong, wibble, KEY_BAR, (void *)qux, KEY_END);


With several arguments used once over.

  mps_foo_opt_s foo_opt_s = FOO_OPT_INIT;
  MPS_OPT0(foo_opt_s, foo, zip);
  MPS_OPT1(foo_opt_s, foo, bar, qux);
  MPS_OPT2(foo_opt_s, foo, baz, xy, zw);
  foo(spong, wibble, &foo_opt_s);

  foo(spong, wibble,
      MPS_KEY_ZIP,
      MPS_KEY_BAR, (void *)qux,
      MPS_KEY_BAZ, (unsigned long)xy, (unsigned long)zw,
      MPS_KEY_END);


With several arguments used several times over.

  mps_foo_opt_s foo_opt_s;
  foo_opt_init(&foo_opt_s);
  MPS_OPT0(foo_opt_s, foo, zip);
  MPS_OPT1(foo_opt_s, foo, bar, qux);
  MPS_OPT2(foo_opt_s, foo, baz, xy, zw);
  foo(spong, wibble, &foo_opt_s);
  MPS_OPT1(foo_opt_s, foo, bar, qux2);
  foo(spong2, wibble2, &foo_opt_s);
  foo(spong3, wibble3, &foo_opt_s);


  foo(spong, wibble,
      MPS_KEY_ZIP,
      MPS_KEY_BAR, (void *)qux,
      MPS_KEY_BAZ, (unsigned long)xy, (unsigned long)zw,
      MPS_KEY_END);
  foo(spong2, wibble2,
      MPS_KEY_ZIP,
      MPS_KEY_BAR, (void *)qux2,
      MPS_KEY_BAZ, (unsigned long)xy, (unsigned long)zw,
      MPS_KEY_END);
  foo(spong3, wibble3,
      MPS_KEY_ZIP,
      MPS_KEY_BAR, (void *)qux2,
      MPS_KEY_BAZ, (unsigned long)xy, (unsigned long)zw,
      MPS_KEY_END);


How the MPS_OPT macro might work:

#define MPS_OPTn(s, t, f, v) \
  do { \
    (s).set = ...
    (s).f_n_0 = v0;
    (s).f_n_1 = v1;


A more concrete example:

  mps_space_opt_s space_opt_s;
  mps_space_opt_init(&space_opt_s);
  MPS_OPT2(space_opt_s, space, client, base, size);
  mps_space_create(&space, &space_opt_s);

  mps_space_create(&space,
                   MPS_KEY_BASE, (void *)base,
                   MPS_KEY_SIZE, (unsigned long)size,
                   MPS_KEY_END);


ACTIONS

.act.decide: Richard will decide what is to be done and write up.

