              NOTES FROM THE MM/EPCORE MEETING, 1996-11-05
                       meeting.epcore.1996-11-05
                               draft doc
                           richard 1996-11-05

INTRODUCTION

.intro: Richard Brooksby <richard> and Nick Barnes <nickb> met David Berry 
<dtb> and Hugo Tyson <hugo> at the request of David.


AGENDA

David: I'd like to know status and future plans.  I haven't spoken to you since 
we met in July.


NOTES

David: There will be a branch in December for the 4.2 product.  The new MM is 
intended to go into 4.2 so it should either go in to the trunk before that or 
just onto the branch.

Hugo: Haven't had much time to work on it.  I'm done improving he interface 
back to the original sophistication.

Nick: Layered is now done, then.  We're all happy.

Hugo: Next step is the layer which is outside of the MM core to do with 
allocating with headers.  SW doesn't generally remember the size.  For most 
objects the size is known, so this layer can be removed.  All simple things 
will be improved.  Nothing hard except doing the typing and making sure.  I've 
added extra assert that object isn't double-freed etc.  Tracing now points to 
actual allocation point.  Started but not checked in.  That's the next thing to 
do.  After that need to find nice hard job to exercise the MM.  Need to see how 
little memory can be got away with to avoid partial paint, then compare timings 
before and after.  Chances are the result will be very close.

Nick: If there is a problem then it will be a segment placement thing.  
[Fragmentation in the MM's placement of memory blocks -- richard]

Hugo: That's it until Christmas, which is about six working weeks away.

Nick: I have a fragmentation meter (bar chart) which may help.

Hugo:  I'm ready to start as soon as I've fixed two bugs and a font bug.  
Should I do that first?

David: No, you can potentially ignore it and get on with MM.  I haven't had any 
push to fix it from Chuck.  There's only Andy, Hugo, and Peter Barada on the 
core RIP group now, so manpower is short. Tony Davis may come in to the group.

[In mail, David clarifies this statement: "now that Tony is finishing with a 
lot of high priority IO work he may be available to work on the core-rip 
again."]

Richard: You should talk to Ian Jackson, a competent C programmer and Unix 
kernel hacker, who I encouraged to apply.  He's coming in for interview shortly.

Hugo: I assume I won't get asked to do StrongARM tests.

[In mail, Hugo adds: This is a separate project, not MM related, not a platform 
for whom MM is especially relevent.  Just clarification.]

David: The main thing is how well the MM deals with small memory 
configurations.  There has been quite a lot of talk about that.  Maybe start in 
8M or 4M and grow.

Richard: We should be able to allow complete dynamism in memory allocation at 
some point in the future.

Nick: That requires a change in the OEM interface.  We also have an "extension" 
interface possibility which is a less radical change ("Arena Extension" 
requirement).  The idea is to avoid paint to disk.

Richard: Point is to avoid "knee" in performance.

David: We may want a small RIP is to allow things like PS preview in Netscape.

Hugo: The Jaws RIP probably doesn't have a display list and so uses much less 
memory.

Nick: May need to reduce the initial startup footprint in the RIP.  A lot of 
this can be discarded because we'll provide fast allocation anyway.

David: Core RIP simplification is required to get this then.

Nick: The other issue is the pre-allocation of PS memory.  It allocates 700K at 
startup.  As PS memory becomes an MPS pool this pre-allocation will decrease, 
so the footprint will also decrease.  This is in psvm.c which we inherited from 
the RIP.

Richard: In MM we're introducing an improved reporting procedure, so you 
[David] should get more reports.

David: We should also get together when we're closer to milestones.  There's no 
substitute for face-to-face meeting.

Hugo: If we get equivalent or better performance out of the non-PS stuff then 
we won't need to rewrite PSVM.

Richard: We should talk to trappists to get them to work with better MM 
protocols.

Hugo: We should talk to them in the group meeting.

Richard: If you ever need a sub-allocator come and talk to us first.

Hugo: In the TT thing we need contiguous expanding array of memory which is 
then partially freed.  The MM system can help with this.

[In mail, Hugo adds: It's Type 1 as well as TT fonts, and interleaved with 
other MM activity; freed back to a default base state (can be zero size in 
future) would be a better description?]

Richard: That's something we can help with if we control the OS memory.  Also 
we can give you a stack-like pool so you don't need to stack allocate.

Nick: Once we're all in place then we'll be in a position to deal with any 
memory issue you have.  At the moment the priority is to get it in and working.

Hugo: People don't really do timing tests on the trunk, so it's possible we 
could release into the trunk earlier.

Nick: But once it's in then you might depend on it, and then you can't back 
out.  It's important to have that strategy.

Hugo: I'll spend the next three weeks working on eliminating headers.  If it 
turns out that there are only ten things which are dynamically sized then I'll 
polish them off, but I won't if there're a hundred.

Nick: Then get a hard job and look at performance.

David: At the end of December we'll have the information we need to decide 
whether to switch over to the new MM.


ACTIONS

.act.free: Hugo will work on putting sizes on frees in the RIP for the next 
three weeks.

.act.rep: Nick will produce a progress report for Richard which he will 
distribute.

.act.branch: David will ascertain the date of the branch for the 4.2 product 
and tell it to mm-epcore.

.act.ian: David will interview Ian Jackson with a view to coming in to the Core 
RIP Group.

.act.trap: David will raise the issue of sub-allocators in the trapping code 
during the next appropriate meeting.

