                 SUMMARY OF DESIGN MEETING, 1997-03-18
                       meeting.general.1997-03-18
                             incomplete doc
                           richard 1997-03-18

INTRODUCTION

.intro: Richard Brooksby <richard> and David Jones <drj> discussed the short 
and longer term design of generations in the AMC pool, and related issues.  
Mainly this was Richard bouncing ideas off David to make sure he had a 
reasonable perspective.


SUMMARY


Use of Zones

During collection, there are four sets of objects to consider when thinking 
about separating zones.  The aim is to minimize the number of "false hits" -- 
calls to fix on objects which aren't white.  This is achieved by separating out 
white objects by zone.

  - condemned objects
  - forwarded objects
  - foundation (non-condemned) objects
  - newly allocated objects

Recently allocated objects are mostly dead.  Therefore there aren't many 
references to them around.  We therefore don't have to worry much about 
creating new objects in the same zone as the condemned set.  (This may turn out 
to be false in some circumstances, but will do for now.)

References to new objects almost exclusively end up in black objects after the 
flip, because they are all that the mutator can see.  Therefore we won't be 
scanning them, so they can't cause false hits.

So, at least initially, it would seem that we don't need to relocate buffers 
out of the condemned generation.  This helps to keep things simple.

It is important that the condemned objects and the foundation objects are 
distinct.


Calculating Summaries

The in-line fix code computes a summary RefSet of all references it is applied 
to, but _before_ they are fixed up.  It is therefore a summary of _old_ 
references.  The summary we want to store in the segment to use as a remembered 
set needs to be a summary of _new_ references.  We don't want to complicate the 
in-line fix code, so the solution is to keep a second summary in the scan state 
which is computed by out-of-line fix and contains only new references.  At the 
end of the scan, the actual summary can be computed as ((oldSummary & 
~whiteSummary) | newSummary), since all references to objects in whiteSummary 
result in calls to out-of-line fix.


Ideas

Allocate white between condemn and flip.

Move buffer to another generation on flip.

Count the number of references to each zone by using summaries during scan.

