                       REVIEW OF IMPL.H.MPMST(8)
                         review.impl.h.mpmst.8
                              draft review
                           gavinm 1996-09-03

Rules: rule.impl
Checklists: check.impl.*
Source: impl.h.mpmtypes, (design.mps.arena, design.mps.arena.vm, design.mps.buffer, 
design.mps.class-interface, design.mps.lock, design.mps.pool, 
design.mps.thread-manager)
Candidate status: accepted

Author: drj
Leader: gavinm
Editor: drj
Scribe: gavinm
Approved: 1996-11-11

Entry: entry.universal, entry.impl
Entry manpower: 1


Entry notes:


Failed: entry.universal.source-approved, entry.universal.rules-approved, and entry.universal.training


Loggingstart: 15:10
Loggingend: 15:59
Logginglength: 49
Loggingrate: 1.9

Checkers: DRJ;Richard;GavinM;NickB;PTW (see below for roles)
Rate: 10 lines/minute
Length: 550 lines
Actual checking time: 275

Kickoff start: 1996-09-04 14:08 BST
Kickoff end: 14:13
Kickoff length: 5


ISSUES:

DRJ: Guide, Mod, Backwards, Design (thread-manager, locks): 13m 1C Only got 400 
lines done
Richard: Platform, Adapt, Design (buffer), Backwards: 19m 2M Only got 300 lines 
done
NickB: Constrain, Min, Dep, Design (pool, class-interface): 2M 24m 4q 10I
GavinM: Req, Quality, Limits, Design (Arena, arenavm): 17m 3C 4I 1q
PTW: Trick, Simple, Justify: 2M 4m

DRJ:
1. 126 MN unsigned can lead to overflow

Richard:
2. 459 M pun?
3. 501-547 M check.impl.design.ref Should be para for every field

NickB:
4. 202-207 M Since this isn't just SunOs, it probably shouldn't be in vmsu.c
5. 393-406 M This LockStruct and ThreadStruct aren't up to much of a job

PTW:
6. 54 M What ensures signatures are unique?
7. 230-232 M What is this trick?

DRJ:
8. 167 m Should expand this comment to include VM_RM
9. 174-176 m Tabbing problem
10. 327 m The use of int here is probably almost completely useles
11. 371 m Should reference design 
12. 346,388 m Comment is inconsistent
13. 417 m This comment is misplaced, trivial, and confusing
14. 441-447 m There are missing comments in these fields
15. 473,474 m These lines aren't commented
16. 481 m Should reference design.mps.weakness
17. 485 m No comment
18. 510 m Should reference missing design
19. 516 m List should be ring for consistency
20. 541 m This is out of place
21. 501-547 C There are a lot of thingRing and thingSerial next to each other

Richard:
22. 297,301 m Must reference buffer and mps-interface design
23. 313-328 m Need to reference buffer design
24. 327 m Closure variables for whom?
25. 342-354 m Must reference format interface design
26. 361-362 m Misplaced design
27. 361-362 m Tag missing
28. 362 These references are imprecise
29. 365-368 m No comments
30. 371 m Reference to design
31. 371 m Justify why per-platform
32. 457 m Missing tag definition; should be referenced by impl.c.mpsi.check
33. 463 I impl.h.mps: Create this tag
34. 474 m Should reference .ss.zone
35. 484 m No section comment
36. 517 m Suggest next created pool
37. 532,536 Didn't we ban iff?
38. 540 m Justify trace_MAX limit

NickB: 
39. - m Lots of structure members which are structs are named confusingly: 99, 
100, 157, 257, 321, 324, 346, 388 , 405, 426, 505, 516, 520, 524, 528, 541
40. 6 m No .readership
41. 7,8 m "partially declared" means "incomplete types"
42. 6-15 m There is a naming convention which should be referenced relating Foo 
and FooStruct
43. 39-103 m Reference design.mps.pool
44. 60,83,etc m Inconsistent use of terminology here "instance"
45. 66-73,76 m No comments 
46. 75 "live" doesn't fit my understanding of word
47. 86 m quibble: each pool" should read "each pool class"
48. 85-89 m This should refer to design.mps.pool and clarify
49. 106-116 m Should say what MFS stands for
50. 106-116 m Should refer to design
51. 114-116,129,141-143,158 m The design text here should be tagged
52. " m It should refer to a design document
53. " m The design text should appear once
54. 135-143 m Shoudl say what MV stands for
55. " m Should refer to design document
56. 156 m Should refer to design document
57. 172-212 q Can these be merged and simplified?
58. 197 q Is this not ==base?
59. 224 m This should be clarified, e.g. "for example"
60. 231,232 m Consistency: Tag definitions shouln't go in line comments
61. 258 m committed or allocated?
62. 290 m Append the word "do"
63. 327 mN line-break
64. 333-337 m These should refer to design
65. 335-337 m Should be tagged
66. " m This should refer to impl.h.mps and impl.c.mpsi
67. 438 m This comment should be rephrased
68. 459-462 m Consistency: Is this pointer called mpm_ss or mps_ss?
69. 543 mN misspelled dependency

PTW: 
70. 34-36 m What happenned to parent pointer for debugging
71. 96 m I don't understand serial, it seems to go with Rings; no design doc
72. 263-267 m These seem out of place
73. 378-382,396-399 m Why don't locks have a serial?

GavinM: 
74. 16 m no referenced requirements
75. 16 m no referenced design
76. 23-25 m why do we include this
77. impl.h.misc I Sig should be 32-bit to correspond to the constants in this 
file
78. 125 q why is unitSize not Align
79. 128 c how about firstSeg instead of segList?
80. 206-207 m Naming convention? *_fd
81. 206-207 m documentation could easily be better
82. 235 m pm and sm are poor names
83. 276 m pages is not a Size
84. 293 I (impl.h.mps.ap) no reverse reference
85. 192,202,393 should document common characteristic of platforms
86. impl.h.mps.ld I no reverse reference to line 362
87. mps.h I should document original types
88. 506,510,532,536 c would these be clearer if we used "is" in the name
89. 509 m need reference
90. 533-535 m sh is an inconsistent abbr of shield

Richard:
91. 231-232 mN Breaks C style guide

Richard want to be consulte dabout minor issues



Brainstorm start: 16:00
Brainstorm end: 16:56
Brainstorm length: 56


BRAINSTORM:

1. Richard: Not strictly true as asserted away, and exported limitation
DRJ: unitsPerSeg can overflow, could specify massive extendBy, unsigned can be 
16 bit
Richard: Used to more asserts; unrecorded dependency.
DRJ: No point in having limitation

2. ScanState structure is closure for Fix function; uses fix function; pun 
happens when function is called.  Probably safe but should be investigated.  
Binary compatability issue.  Might not need pun if we used extra function, but 
is on critical path.  How do we stop punning problems sneaking in?  Interface 
languages mighyt help.  When can puns occur?  Should define where.  NickB has 
PLDI96 reference.

3. Space structure has disparate set of fields.  Richard can see large cost 
mounting.  Should be explained in space design.  Could have little 
sub-structures.  Richard doesn't like this.  How can we avoid it?  Disparate 
and global.  What about when someone next adds fileds to SpaceStruct.  Need 
design and reference.

4. SO was added without changing documentation and tags.  vmso.c and vmsu.c use 
same structures.  GavinM suggested that having mmap in support library would 
solve this.  mmap doesn't belong in the support library, but we could have one 
mmap.  Every VM thing is roughly similar, excpet perhaps Windows.  There was a 
duplication step.  VM was supposed to be thin, perhaps it's too thick.  Should 
have documented disjunction.  Could have characteristic macros, or maybe not.

5. Design defect.  They're not supposed to do anything.  "Fake" means something 
different here.  Locks and Threads will only work with these if there is only 
one Thread.  We don't support threads on anything except Windows.  Need to 
write this down.  Should reference plan.

6. grep.  Should be in InfoSys.  Should document mnemonic system.  Will need to 
do this with event types.

7. Trick defined in ANSI standard.  Efficiency trick.  Trick allows table of 
segment structures to be table of Segs.  NULL Pool means it's something else.

Design role coudl have been explained tomorrow

[ Richard and DRJ leaving. ]

Much better with handsets.  GavinM gets stiff neck while he types.  

Finishing.  PTW got to 411, DRJ did 400 lines, Richard did 300 lines.  GavinM 
finished but got no Major issues.  Review speed varies per document.  Can't 
slow without impacting schedule.  10lines/min for C files.  Gavin cuts people 
off; should he do this?  Gavin could arrange lifts by leaving earlier on 
Wednesdays.  Process Brainstorm too long?  

Getting things reviewed, but not editted.  Process feedback tenuous.

Could have two reviews per week, each half as long.



Number of major issues: 7
Number of minor issues: 73
Number of issues: 91
Major defects remaining: 0.8

Edit manpower: 15


Edit notes:

1 fix
2 issue in mail
3 issue in mail
4 fix, doc
5 reject, it's not supposed to be
6 fix, added design.mps.sig.test.uniq
7 fix, added design.mps.seg.assume.pointer-conversion
8 fix
9 fix
10 issue, mailed
11 fix
12 fix
13 fix
14 fix
15 fix
16 fix
17 fix
18 fix
19 fix
20 fix
21 forget.  but see also design.mps.serial
22 fix
23 fix
24 fix
25 fix
26 fix
27 fix
28 fix
29 fix
30 fix
31 fix
32 fix
33 fix
34 fix
35 fix
36 fix
37 fix
38 fix
39 fix
40 fix
41 fix
42 fix, changed guide.impl.c.format.comment
43 fix
44 fix, instance replaced with outer structure / generic structure.
   desigm.mps.pool
45 fix.
46 fix. now uses "reachable" instead of "live"
47 fix
48 fix
49 fix
50 fix
51 fix design.mps.pool.outer-structure.sig
52 fix
53 fix
54 fix
55 fix
56 fix
57 mail
58 mail
59 fix
60 fix
61 fix
62 fix
63 fix
64 fix
65 fix
66 fix
67 fix
68 fix
69 fix
70 forget, see mail.richard_brooksby.1996-03-25.16-02
71 fix design.mps.serial
72 fix
73 fix, answered this "question"
74 fix
75 fix
76 fix
77 reject, unsigned long is at least 32 bits
78 mail
79 forget, it's a bad name I agree, but it's trivial.
80 fix (doc'ed)
81 fix
82 reject, they're brief and documented.
83 fix
84 fix
85 fix
86 fix
87 forget
88 forget
89 fix
90 forget
91 fix



Exit: exit.universal
Exit manpower: 0.5


Exit notes:

Not all issues classed.
All tests in DF pass.
Issue 1 could easily have cost 1000 man-hours


Manpowerused: 30
Manpowersaved: 1060


What about universal rules?

