      SPARC WINDOW FRAMES ARE NOT FLUSHED BEFORE WE SCAN THE STACK
                          issue.sp-stack-flush
                       obsolete complete defect 
                             drj 1995-08-21

Urgency: 8 - rush
Importance: 6 - significant
Discoverer: drj;dsm;richard
Discovery date: 21/08/95 18:27:50
Discovery process: running dwstress
Locaction: MMprod_dw_src!dw.c(1.4)


DESCRIPTION:

SPARC window frames are not flushed before we scan the stack

ROOT CAUSE:



SUGGESTIONS:

Flush the windows before we scan the stack (this involves writing some assembly)

richard:

I suggest modifying stackScan in dw.c approximately thus:

/* SPARC window frames must be flushed before scanning the stack */
/* This is a temporary patch, according to proc.releae.defect.patch(0) */
/* See also issue.general.impl.sparc.stack-flush. */

stackScan()
{
  void *marker = &marker;
#ifdef ARCH_SPARC
#if !defined(OS_SUNOS) || !define(BUILD_GCC)
#error "Need SunOS etc."
#endif
  __asm("ta 3");        /* flush register windows */
#endif
  scanScan2(marker);    /* nested call avoids problems with updating local 
frame */
}

PROCESS SUGGESTIONS:



Resolver: drj


