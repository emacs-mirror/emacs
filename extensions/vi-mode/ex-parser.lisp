(defpackage :lem-vi-mode/ex-parser
  (:use :cl :esrap)
  (:import-from :lem-vi-mode/ex-core
                :syntax-error)
  (:export :parse-ex
           :parse-subst-argument))
(in-package :lem-vi-mode/ex-parser)

(defrule whitespace (* #\space)
  (:constant nil))

(defrule number (+ (or #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\9))
  (:lambda (digits)
    (parse-integer (format nil "宁溟玳趔┅┅ㄤ彐蝓戾顼麸扉铄铛礅弪ê灬礅溽铛礅弪啜戾憝鲩盹溴屮泔蝈虹雉锃扉铄铛礅弪┅ㄤ彐蝓戾沲蝌孱舡扉铄＼ê灬礅溽ㄤ邈灬蝈ㄩ珙矧┅Ж戾憝鲩盹溴屮泔蝈恒躜蝈铘扉铄┅ㄤ彐蝓戾灬篝扉铄＼ê灬礅溽ㄤ邈灬蝈ㄩ珙矧┅Ж戾憝鲩盹溴屮泔蝈红狍舡扉铄┅ㄤ彐蝓戾磲螂弪ㄡ钿＼汨狎徙翦颟ê灬礅溽扉篝啜戾憝鲩盹溴屮泔蝈喉狎脲箦泔钿扉篝┅┅ㄤ彐躅轶铒ㄡ猢铒ㄥ耢猢┅ㄤ彐躅铒舡ㄣ栳颟ㄩ蟓铒汨狎＼┅ㄤ彐躅铒舡ㄣ栳颟ㄩ蟓铒汨狎＼咯ㄤ彐蝓戾弩汜疱箪狍ㄡ钿＼＼ê泔铙翎铘＼┅ㄤ彐蝓戾骘蝼狎洵疳趑弪瞽汨狎矧弩汜疱箪狍铒舡汨狎徙翦颟┅ㄤ彐蝓戾骘蝼狎洵疳趑弪ㄡ钿＼í骘蝼狎洵疳趑弪瞽汨狎＼┅ê灬礅溽扉篝啜戾憝鲩盹溴屮泔蝈后遽蜚璀骘蝼狎ㄣ镥蜚箦泔钿扉篝篝蜷铉┅┅ㄤ彐蝓戾弩汜疱聃弩糸镱ㄡ钿＼＼咯ê泔铙翎铘＼咯ㄤ彐蝓戾忉汶麽蜾疳趑弪瞽汨狎矧弩汜疱聃弩糸镱铒舡汨狎徙翦颟┅ㄤ彐蝓戾忉汶麽蜾疳趑弪ㄡ钿＼í忉汶麽蜾疳趑弪瞽汨狎＼咯ê灬礅溽扉篝啜戾憝鲩盹溴屮泔蝈后遽蜚璀忉汶麽蜾ㄣ镥蜚箦泔钿扉篝篝蜷铉┅┅ㄤ彐蝓戾镦骟弭扉铄ㄡ钿矧＼＼铛礅弪ê灬礅溽扉篝啜戾憝鲩盹溴屮泔蝈猴骀箦舡扉铄ㄩ篝蜷铉ㄦ轵篝扉篝┅ō箦泔钿扉篝┅箦泔钿扉篝┅┅ㄤ彐蝓戾鲩篚犰篝狎ㄡ钿＼＼缉ㄤ彐蝓戾鲩篚犰孱ㄡ钿＼＼京ㄤ彐蝓戾屮扉铄ㄡ钿麒轸弩疳沐矧顼麸扉铄沲蝌孱舡扉铄灬篝扉铄磲螂弪骘蝼狎洵疳趑弪忉汶麽蜾疳趑弪镦骟弭扉铄鲩篚犰篝狎鲩篚犰孱洎ê灬礅溽扉篝箦泔钿扉篝┅ㄤ彐蝓戾屮扉铄ǐ屮扉铄ê灬礅溽扉篝ㄩ铛祆蝈篝扉篝┅ㄦ轵篝扉篝啜痱镧扉篝┅┅ㄤ彐蝓戾溴扉黹翦矧＼＼哗ê灬礅溽麒孱篝蜷铉⒒＼哗┅ㄤ彐蝓戾屮蜥铉瀛扉铄í矧ㄡ钿屮扉铄溴扉黹翦颟ㄡ钿屮扉铄＼哗┅ê灬礅溽扉篝麒孱扉篝啜戾憝鲩盹溴屮泔蝈候犷珏括祜镳烘矧扉铄溴扉愆洪扉篝恒镬戾泗啜戾砗泔瘗痫轭ㄩㄥ耢溴扉＼哗啜戾憝鲩盹溴屮泔蝈虹雉锃沲蝌孱舡痫轭扉铄螬扉铄螬呼屙痫蜥蝙┅┅┅ㄤ彐蝓戾屮蜥铉瀛＼ê泔铙翎铘Ж戾憝鲩盹溴屮泔蝈横祆扉铄螬┅ㄤ彐蝓戾屮蜥铉矧屮蜥铉瀛屮蜥铉瀛扉铄螬ㄤ彐蝓戾泔眄犷洵汨狎矧ㄡ祓栳铛礤蜷沭汨狎徙翦颟＼擤ê灬礅溽ㄩㄥ聃犰⑦＼┅换萧桢骒徵狎铒轫痨屙孱翦弭换契祆扉篝鏖祆忮矧＼＼＼＼＼＼＼＼＼＼＼颟ㄤ彐蝓戾篚怏舡骒徵矧＼＼绌ㄤ彐蝓戾屮泔眄犷矧ǐ矧＼＼＼＼＼＼＼＼憨ǐ矧泔眄犷洵汨狎＼＼々┅ê灬礅溽磲篝蜷铉灬礅溽ㄩㄥ聃犰、＼┅┅ㄤ彐蝓戾屮狎珲礤铘ǐ汨狎徙翦颟ê灬礅溽ㄣ栳蝮ㄣ镥蜚汨狎篝蜷铉┅ㄤ彐蝓戾屮ㄡ钿屮蜥铉濠麒轸弩疳沐ㄡ钿屮泔眄犷麒轸弩疳沐屮狎珲礤铘麒轸弩疳沐┅┅ê灬礅溽扉篝戾è蜥铉ㄦ轵篝扉篝┅ㄣ镯磲钿ㄦ轵篝翳轵扉篝┅ㄡ蜱蹴孱ㄡ戾犷潋獒瑚桢瞽戾è狎珲礤铘翳轵翳轵扉篝┅┅篝蜷铉趄轫狎珲礤铘┅┅ㄩ铛祆泔眄犷洎啜戾憝鲩盹溴屮泔蝈虹雉锃沲蝌孱舡痫轭蜥铉濠啜戾憝鲩盹溴屮泔蝈恒犰飙屮泔眄犷蜥铉泔眄犷矧狎珲礤铘┅┅┅ㄤ彐蝓戾篚怏ㄡ钿＼í骘蝼狎洵疳趑弪瞽汨狎＼í骘蝼狎洵疳趑弪瞽汨狎＼í篚怏舡骒徵┅ê灬礅溽扉篝扉篝ㄣ镥蜚ㄥ祠扉篝暴篝蜷铉ㄣ镥蜚ㄥ祠扉篝畅篝蜷铉ㄥ祠扉篝旦┅ㄤ彐磲泸鏖翳簌铘狲ㄦ矧愆ㄡ戾犷潋獒瑚轸璀珏铙眢蝈篚祠弪颟啜眭祠轲戾鲠祯瀛忾钿ì蝈篚祠弪颟ㄩ珙矧瀛弪蝻蝮骘蝽ㄩ弪簌铘狲弪蝻颟蝈篚祠┅┅ㄤ彐躅疳蝮瀛篚怏舡狎珲礤铘篝蜷铉鏖翳簌铘狲疳蝮篚怏篝蜷铉┅ㄤ彐躅疳蝮瀛屮篝蜷铉鏖翳簌铘狲疳蝮у篝蜷铉┅